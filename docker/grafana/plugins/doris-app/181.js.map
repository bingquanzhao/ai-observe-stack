{"version":3,"file":"181.js?_cache=ca373cf1ef6fe5fbc000","mappings":"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","sources":["webpack://doris-app/./components/trace-detail/index.tsx","webpack://doris-app/./utils/utils.ts","webpack://doris-app/./services/traces.sql.ts","webpack://doris-app/./services/traces.ts","webpack://doris-app/./store/traces.ts","webpack://doris-app/./store/discover.ts","webpack://doris-app/./utils/data.ts","webpack://doris-app/./types/type.ts","webpack://doris-app/./services/metaservice.ts"],"sourcesContent":["import { LoadingState } from '@grafana/data';\nimport { PanelRenderer } from '@grafana/runtime';\nimport { Drawer, LoadingPlaceholder } from '@grafana/ui';\nimport { useAtom, useAtomValue } from 'jotai';\nimport React, { useEffect } from 'react';\nimport { getTableDataTraceService } from 'services/traces';\nimport { currentCatalogAtom, currentDatabaseAtom, tableTracesDataAtom, selectedDatasourceAtom, selectedRowAtom } from 'store/discover';\nimport { currentTraceTableAtom } from 'store/traces';\nimport { formatTracesResData } from 'utils/data';\n\nexport default function TraceDetail(props: { onClose?: () => void; open: boolean; traceId?: string; traceTable?: string }) {\n    const currentTable = useAtomValue(currentTraceTableAtom);\n    const currentCatalog = useAtomValue(currentCatalogAtom);\n    const currentDatabase = useAtomValue(currentDatabaseAtom);\n    const [traceData, setTraceData] = useAtom(tableTracesDataAtom);\n    const selectedRow = useAtomValue(selectedRowAtom);\n    const selectdbDS = useAtomValue(selectedDatasourceAtom);\n    const traceTable = props?.traceTable || currentTable || 'otel_traces';\n    const [loading, setLoading] = React.useState(false);\n\n    const { open, traceId } = props;\n\n    const getTraceData = React.useCallback(() => {\n        let payload: any = {\n            catalog: currentCatalog,\n            database: currentDatabase,\n            table: traceTable,\n            cluster: '',\n            sort: 'DESC',\n            trace_id: traceId || '',\n        };\n        setLoading(true);\n\n        getTableDataTraceService({\n            selectdbDS,\n            ...payload,\n        }).subscribe({\n            next: ({ data, ok }: any) => {\n                setLoading(false);\n                if (ok) {\n                    const formatedData = formatTracesResData(data.results.getTableDataTrace.frames[0]);\n                    setTraceData(formatedData);\n                }\n            },\n            error: (err: any) => {\n                setLoading(false);\n                console.log('Fetch Error', err);\n            },\n        });\n    }, [currentCatalog, currentDatabase, traceTable, selectdbDS, setTraceData, traceId]);\n\n    useEffect(() => {\n        if (traceId) {\n            getTraceData();\n        }\n    }, [selectedRow.trace_id, currentCatalog, currentDatabase, selectdbDS, setTraceData, getTraceData, traceId]);\n\n    function renderTracePanel() {\n        if (traceData) {\n            return (\n                <PanelRenderer\n                    title=\"test\"\n                    width={200}\n                    height={300}\n                    pluginId=\"traces\"\n                    options={{}}\n                    data={{\n                        state: loading ? LoadingState.Loading : LoadingState.Done,\n                        series: [traceData],\n                        timeRange: {\n                            from: new Date(Date.now() - 15 * 60 * 1000) as any, // 15 分钟前\n                            to: new Date() as any,\n                            raw: {\n                                from: 'now-15m',\n                                to: 'now',\n                            },\n                        },\n                    }}\n                />\n            );\n        }\n        return null;\n    }\n\n    return (\n        <>\n            {open && (\n                <Drawer\n                    title=\"Trace Panel\"\n                    onClose={() => {\n                        props?.onClose?.();\n                    }}\n                    size=\"lg\"\n                >\n                    {loading ? <LoadingPlaceholder text={`Loading`} /> : renderTracePanel()}\n                </Drawer>\n            )}\n        </>\n    );\n}\n","// --- stable stringify: 递归排序键，避免循环引用导致崩溃 ---\nfunction stableStringify(value: any): string {\n    const seen = new WeakSet();\n\n    const recur = (v: any): string => {\n        if (v === null) {\n            return 'null';\n        }\n        const t = typeof v;\n        if (t === 'number') {\n            return Number.isFinite(v) ? String(v) : 'null';\n        }\n        if (t === 'boolean') {\n            return v ? 'true' : 'false';\n        }\n        if (t === 'string') {\n            return JSON.stringify(v);\n        }\n        if (t === 'bigint') {\n            return JSON.stringify(v.toString());\n        }\n        if (t === 'undefined' || t === 'function' || t === 'symbol') {\n            return 'null';\n        }\n\n        // object / array\n        if (seen.has(v)) {\n            return '\"[Circular]\"';\n        }\n        seen.add(v);\n\n        if (Array.isArray(v)) {\n            return '[' + v.map(recur).join(',') + ']';\n        }\n\n        const keys = Object.keys(v).sort();\n        const body = keys.map(k => JSON.stringify(k) + ':' + recur(v[k])).join(',');\n        return '{' + body + '}';\n    };\n\n    return recur(value);\n}\n\n// --- 小工具 ---\nfunction u8ToHex(u8: Uint8Array): string {\n    let out = '';\n    for (let i = 0; i < u8.length; i++) {\n        out += u8[i].toString(16).padStart(2, '0');\n    }\n    return out;\n}\n\nfunction hasSubtle(): boolean {\n    return typeof window !== 'undefined' && !!window.crypto && !!window.isSecureContext && typeof window.crypto.subtle?.digest === 'function';\n}\n\n// --- 纯 JS 的 SHA-256 fallback（简实现，无依赖） ---\nfunction sha256HexJS(data: Uint8Array): string {\n    // 常量\n    const K = new Uint32Array([\n        0x428a2f98, 0x71374491, 0xb5c0fbcf, 0xe9b5dba5, 0x3956c25b, 0x59f111f1, 0x923f82a4, 0xab1c5ed5, 0xd807aa98, 0x12835b01, 0x243185be, 0x550c7dc3, 0x72be5d74, 0x80deb1fe,\n        0x9bdc06a7, 0xc19bf174, 0xe49b69c1, 0xefbe4786, 0x0fc19dc6, 0x240ca1cc, 0x2de92c6f, 0x4a7484aa, 0x5cb0a9dc, 0x76f988da, 0x983e5152, 0xa831c66d, 0xb00327c8, 0xbf597fc7,\n        0xc6e00bf3, 0xd5a79147, 0x06ca6351, 0x14292967, 0x27b70a85, 0x2e1b2138, 0x4d2c6dfc, 0x53380d13, 0x650a7354, 0x766a0abb, 0x81c2c92e, 0x92722c85, 0xa2bfe8a1, 0xa81a664b,\n        0xc24b8b70, 0xc76c51a3, 0xd192e819, 0xd6990624, 0xf40e3585, 0x106aa070, 0x19a4c116, 0x1e376c08, 0x2748774c, 0x34b0bcb5, 0x391c0cb3, 0x4ed8aa4a, 0x5b9cca4f, 0x682e6ff3,\n        0x748f82ee, 0x78a5636f, 0x84c87814, 0x8cc70208, 0x90befffa, 0xa4506ceb, 0xbef9a3f7, 0xc67178f2,\n    ]);\n\n    // 初始哈希\n    let h0 = 0x6a09e667,\n        h1 = 0xbb67ae85,\n        h2 = 0x3c6ef372,\n        h3 = 0xa54ff53a,\n        h4 = 0x510e527f,\n        h5 = 0x9b05688c,\n        h6 = 0x1f83d9ab,\n        h7 = 0x5be0cd19;\n\n    // 预处理：填充\n    const l = data.length;\n    const bitLenHi = (l >>> 29) >>> 0;\n    const bitLenLo = (l << 3) >>> 0;\n    const nBlocks = (((l + 9) >> 6) + 1) << 4; // 以 16 个 32bit 为一组\n    const M = new Uint32Array(nBlocks);\n\n    for (let i = 0; i < l; i++) {\n        M[i >> 2] |= data[i] << ((3 - (i & 3)) << 3);\n    }\n    M[l >> 2] |= 0x80 << ((3 - (l & 3)) << 3);\n    M[nBlocks - 2] = bitLenHi;\n    M[nBlocks - 1] = bitLenLo;\n\n    const W = new Uint32Array(64);\n\n    const rotr = (x: number, n: number) => (x >>> n) | (x << (32 - n));\n    for (let i = 0; i < nBlocks; i += 16) {\n        for (let t = 0; t < 16; t++) {\n            W[t] = M[i + t];\n        }\n        for (let t = 16; t < 64; t++) {\n            const s0 = (rotr(W[t - 15], 7) ^ rotr(W[t - 15], 18) ^ (W[t - 15] >>> 3)) >>> 0;\n            const s1 = (rotr(W[t - 2], 17) ^ rotr(W[t - 2], 19) ^ (W[t - 2] >>> 10)) >>> 0;\n            W[t] = (W[t - 16] + s0 + W[t - 7] + s1) >>> 0;\n        }\n\n        let a = h0,\n            b = h1,\n            c = h2,\n            d = h3,\n            e = h4,\n            f = h5,\n            g = h6,\n            h = h7;\n\n        for (let t = 0; t < 64; t++) {\n            const S1 = (rotr(e, 6) ^ rotr(e, 11) ^ rotr(e, 25)) >>> 0;\n            const ch = ((e & f) ^ (~e & g)) >>> 0;\n            const T1 = (h + S1 + ch + K[t] + W[t]) >>> 0;\n            const S0 = (rotr(a, 2) ^ rotr(a, 13) ^ rotr(a, 22)) >>> 0;\n            const maj = ((a & b) ^ (a & c) ^ (b & c)) >>> 0;\n            const T2 = (S0 + maj) >>> 0;\n\n            h = g;\n            g = f;\n            f = e;\n            e = (d + T1) >>> 0;\n            d = c;\n            c = b;\n            b = a;\n            a = (T1 + T2) >>> 0;\n        }\n\n        h0 = (h0 + a) >>> 0;\n        h1 = (h1 + b) >>> 0;\n        h2 = (h2 + c) >>> 0;\n        h3 = (h3 + d) >>> 0;\n        h4 = (h4 + e) >>> 0;\n        h5 = (h5 + f) >>> 0;\n        h6 = (h6 + g) >>> 0;\n        h7 = (h7 + h) >>> 0;\n    }\n\n    const out = new Uint8Array(32);\n    const H = [h0, h1, h2, h3, h4, h5, h6, h7];\n    for (let i = 0; i < 8; i++) {\n        out[i * 4 + 0] = (H[i] >>> 24) & 0xff;\n        out[i * 4 + 1] = (H[i] >>> 16) & 0xff;\n        out[i * 4 + 2] = (H[i] >>> 8) & 0xff;\n        out[i * 4 + 3] = H[i] & 0xff;\n    }\n    return u8ToHex(out);\n}\n\n// --- 通用 SHA-256（浏览器优先，fallback 到纯 JS） ---\nasync function sha256Hex(input: string): Promise<string> {\n    const data = new TextEncoder().encode(input);\n    if (hasSubtle()) {\n        const buf = await window.crypto.subtle.digest('SHA-256', data);\n        return u8ToHex(new Uint8Array(buf));\n    }\n    // 非 https 或老环境：走纯 JS\n    return sha256HexJS(data);\n}\n\n// --- 你的两个导出函数 ---\nexport async function generateUid(obj: any) {\n    const json = stableStringify(obj);\n    return sha256Hex(json);\n}\n\nexport async function generateTableDataUID(items: any[]) {\n    // 允许 _original 缺失时退回整个 item；并发计算，更快\n    const sources = items.map(it => (it && it._original) ?? it);\n    const uids = await Promise.all(sources.map(generateUid));\n    return items.map((it, i) => ({ ...it, _uid: uids[i] }));\n}\n\n\nexport function isIgnorableHighlightToken(token: string): boolean {\n    const ignoreChars = new Set([\n        ',',\n        '.',\n        ';',\n        ':',\n        '(',\n        ')',\n        '{',\n        '}',\n        '[',\n        ']',\n        '+',\n        '-',\n        '*',\n        '/',\n        '=',\n        '<',\n        '>',\n        '!',\n        '?',\n        '|',\n        '&',\n        '%',\n        '^',\n        '$',\n        '#',\n        '@',\n        '~',\n        '`',\n        '\\\\',\n        \"'\",\n        '\"',\n    ]);\n    // 全是空格或换行\n    if (!token.trim()) {return true;}\n    // 单个字符且在 ignoreChars 中\n    if (token.length === 1 && ignoreChars.has(token)) {return true;}\n    // 多个字符但全是标点符号\n    if (/^[\\u2000-\\u206F\\u2E00-\\u2E7F!\"#$%&'()*+,\\-./:;<=>?@[\\\\\\]^_`{|}~]+$/.test(token)) {\n        return true;\n    }\n\n    return false;\n}\n","import { QueryTracesParams, TracesOperationsParams, TracesServicesParams } from 'types/type';\n\ninterface QueryTraceDetailParams {\n    database: string;\n    table: string;\n    trace_id: string;\n}\n\n// 查询某个Table的Trace详情\nexport function getQueryTableTraceSQL(params: QueryTraceDetailParams): string {\n    const { table, trace_id, database } = params;\n\n    const sql = `\n      SELECT\n        trace_id AS traceID,\n        span_id AS spanID,\n        parent_span_id AS parentSpanID,\n        span_name AS operationName,\n        service_name AS serviceName,\n        CONCAT(\n          '[',\n          array_join(\n            array_map(\n              (x, y) -> json_object('key', x, 'value', y),\n              map_keys(CAST(CAST(resource_attributes AS TEXT) AS MAP<STRING, STRING>)),\n              map_values(CAST(CAST(resource_attributes AS TEXT) AS MAP<STRING, STRING>))\n            ),\n            ','\n          ),\n          ']'\n        ) AS serviceTags,\n        UNIX_TIMESTAMP(timestamp) * 1000 AS startTime,\n        duration / 1000 AS duration,\n        CONCAT(\n          '[',\n          array_join(\n            array_map(\n              (x, y) -> json_object('key', x, 'value', y),\n              map_keys(CAST(CAST(span_attributes AS TEXT) AS MAP<STRING, STRING>)),\n              map_values(CAST(CAST(span_attributes AS TEXT) AS MAP<STRING, STRING>))\n            ),\n            ','\n          ),\n          ']'\n        ) AS tags,\n        span_kind AS kind,\n        CASE status_code\n          WHEN 'STATUS_CODE_OK' THEN 1\n          WHEN 'STATUS_CODE_ERROR' THEN 2\n          ELSE 0\n        END AS statusCode,\n        status_message AS statusMessage,\n        scope_name AS instrumentationLibraryName,\n        scope_version AS instrumentationLibraryVersion,\n        trace_state AS traceState\n      FROM ${database}.\\`${table}\\`\n      WHERE trace_id = '${trace_id}';\n    `;\n\n    return sql;\n}\n\nfunction parseDuration(input?: string): number {\n    if (!input) {\n        return 0;\n    }\n\n    if (input.endsWith('ms')) {\n        return parseFloat(input.replace('ms', ''));\n    } else if (input.endsWith('us')) {\n        return parseFloat(input.replace('us', '')) / 1000;\n    } else if (input.endsWith('s')) {\n        return parseFloat(input.replace('s', '')) * 1000;\n    }\n    return 0;\n}\n\nfunction tagsToDorisSQLConditions(tags?: string): string {\n    if (!tags) {\n        return '1=1';\n    }\n    const conditions: string[] = [];\n\n    const regex = /(\\w+)=([^\\s]+)/g;\n    let match: RegExpExecArray | null;\n    while ((match = regex.exec(tags)) !== null) {\n        const key = match[1];\n        const val = match[2];\n        conditions.push(`span_attributes['${key}'] = '${val}'`);\n    }\n\n    return conditions.length > 0 ? conditions.join(' AND ') : '1=1';\n}\n\nexport function buildTraceAggSQLFromParams(params: QueryTracesParams): string {\n    const timeFilter = `${params.timeField} >= '${params.startDate}' AND ${params.timeField} < '${params.endDate}'`;\n\n    const serviceFilter = params.service_name && params.service_name !== 'all' ? `service_name = '${params.service_name}'` : '1=1';\n\n    const operationFilter = params.operation && params.operation !== 'all' ? `span_name = '${params.operation}'` : '1=1';\n\n    const statusFilter = params.statusCode && params.statusCode !== 'all' ? `status_code = '${params.statusCode}'` : '1=1';\n\n    const minDuration = parseDuration(params.minDuration);\n    const maxDuration = parseDuration(params.maxDuration);\n\n    let durationFilter = '1=1';\n    if (minDuration > 0 && maxDuration > 0) {\n        durationFilter = `trace_duration BETWEEN ${minDuration} AND ${maxDuration}`;\n    } else if (minDuration > 0) {\n        durationFilter = `trace_duration >= ${minDuration}`;\n    } else if (maxDuration > 0) {\n        durationFilter = `trace_duration <= ${maxDuration}`;\n    }\n\n    const tagsFilter = tagsToDorisSQLConditions(params.tags);\n\n    let rootSpansFilter = '1=1';\n    if (params.service_name && params.service_name !== 'all') {\n        rootSpansFilter = `service_name = '${params.service_name}'`;\n    }\n    if (params.operation && params.operation !== 'all') {\n        rootSpansFilter += ` AND span_name = '${params.operation}'`;\n    }\n\n    const limit = params.page_size ?? 1000;\n    const offset = Math.max(((params.page ?? 1) - 1) * limit, 0);\n\n    let rowNumberOrderBy = 'time DESC';\n    switch (params.sortBy) {\n        case 'longest-duration':\n            rowNumberOrderBy = 'trace_duration_ms DESC';\n            break;\n        case 'shortest-duration':\n            rowNumberOrderBy = 'trace_duration_ms ASC';\n            break;\n        case 'most-spans':\n            rowNumberOrderBy = 'spans DESC';\n            break;\n        case 'least-spans':\n            rowNumberOrderBy = 'spans ASC';\n            break;\n        case 'most-recent':\n            rowNumberOrderBy = 'time DESC';\n            break;\n    }\n\n    const query = `\nUSE ${params.database};\n\nWITH\n  trace_durations AS (\n    SELECT\n      trace_id,\n      (UNIX_TIMESTAMP(MAX(end_time)) - UNIX_TIMESTAMP(MIN(timestamp))) * 1000 AS trace_duration\n    FROM ${params.table}\n    WHERE ${timeFilter}\n    GROUP BY trace_id\n  ),\n  all_trace_ids AS (\n    SELECT\n      t.trace_id,\n      MIN(t.${params.timeField}) AS time,\n      d.trace_duration\n    FROM ${params.table} t\n    JOIN trace_durations d ON t.trace_id = d.trace_id\n    WHERE\n      ${timeFilter}\n      AND ${serviceFilter}\n      AND ${operationFilter}\n      AND ${statusFilter}\n      AND ${tagsFilter}\n      AND 1=1\n      AND ${durationFilter}\n    GROUP BY t.trace_id, d.trace_duration\n  ),\n  root_spans AS (\n    SELECT\n      trace_id,\n      span_name AS operation,\n      service_name AS root_service\n    FROM ${params.table}\n    WHERE (parent_span_id IS NULL OR parent_span_id = '') AND ${rootSpansFilter}\n  ),\n  aggregated AS (\n    SELECT\n      UNIX_TIMESTAMP(MIN(t.${params.timeField})) AS time,\n      t.trace_id,\n      r.operation,\n      r.root_service,\n      COLLECT_SET(t.service_name) AS services,\n      COUNT(*) AS spans,\n      SUM(IF(status_code = 'STATUS_CODE_ERROR', 1, 0)) AS error_spans,\n      MAX(duration) / 1000 AS max_span_duration_ms,\n      MAX(UNIX_TIMESTAMP(t.timestamp) * 1000 + duration / 1000) - MIN(UNIX_TIMESTAMP(t.timestamp) * 1000) AS trace_duration_ms,\n      MAX(IF(t.parent_span_id IS NULL OR t.parent_span_id = '', duration, 0)) / 1000 AS root_span_duration_ms\n    FROM ${params.table} t\n    JOIN all_trace_ids a ON t.trace_id = a.trace_id\n    JOIN root_spans r ON t.trace_id = r.trace_id\n    GROUP BY t.trace_id, r.operation, r.root_service\n  ),\n  numbered AS (\n    SELECT\n      a.*,\n      COUNT(*) OVER() AS total_count,\n      ROW_NUMBER() OVER(ORDER BY ${rowNumberOrderBy}) AS rn\n    FROM aggregated a\n  )\n\nSELECT\n  *,\n  total_count AS total\nFROM numbered\nWHERE rn > ${offset} AND rn <= ${offset + limit}\nORDER BY ${rowNumberOrderBy};\n`;\n\n    return query;\n}\n\nexport function getServiceListSQL(params: TracesServicesParams): string {\n    return `\n    SELECT DISTINCT service_name \n    FROM ${params.table} \n    WHERE ${params.timeField} BETWEEN '${params.startDate}' AND '${params.endDate}' \n    ORDER BY service_name ASC\n  `;\n}\n\nexport function getOperationListSQL(params: TracesOperationsParams): string {\n    return `\n    SELECT DISTINCT span_name \n    FROM ${params.table} \n    WHERE ${params.timeField} BETWEEN '${params.startDate}' AND '${params.endDate}' \n    AND service_name = '${params.service_name}'\n    ORDER BY span_name ASC\n  `;\n}\n","import { getBackendSrv } from \"@grafana/runtime\";\nimport { buildTraceAggSQLFromParams, getOperationListSQL, getQueryTableTraceSQL, getServiceListSQL } from \"./traces.sql\";\n\n// 获取table的Trace数据\nexport function getTableDataTraceService(payload: any) {\n    const { selectdbDS, ...rest } = payload;\n    const traceSQL = getQueryTableTraceSQL(rest);\n    return getBackendSrv().fetch({\n        url: '/api/ds/query',\n        method: 'POST',\n        data: {\n            queries: [\n                {\n                    refId: 'getTableDataTrace',\n                    datasource: {\n                        type: 'mysql',\n                        uid: selectdbDS.uid,\n                    },\n                    rawSql: traceSQL,\n                    format: 'table',\n                },\n            ],\n        },\n        credentials: 'include',\n    });\n}\n\n// 查询Traces\nexport function getTracesService(payload: any) {\n    const { selectdbDS, ...rest } = payload;\n    const getTracesSQL = buildTraceAggSQLFromParams(rest);\n    return getBackendSrv().fetch({\n        url: '/api/ds/query',\n        method: 'POST',\n        data: {\n            queries: [\n                {\n                    refId: 'getTraces',\n                    datasource: {\n                        type: 'mysql',\n                        uid: selectdbDS.uid,\n                    },\n                    rawSql: getTracesSQL,\n                    format: 'table',\n                },\n            ],\n        },\n        credentials: 'include',\n    });\n}\n\n// 查询Trace Services\nexport function getServiceListService(payload: any) {\n    const { selectdbDS, ...rest } = payload;\n    const serviceListSQL = getServiceListSQL(rest);\n    return getBackendSrv().fetch({\n        url: '/api/ds/query',\n        method: 'POST',\n        data: {\n            queries: [\n                {\n                    refId: 'getServiceList',\n                    datasource: {\n                        type: 'mysql',\n                        uid: selectdbDS.uid,\n                    },\n                    rawSql: serviceListSQL,\n                    format: 'table',\n                },\n            ],\n        },\n        credentials: 'include',\n    });\n}\n\n// 查询Trace Operations\nexport function getOperationListService(payload: any) {\n    const { selectdbDS, ...rest } = payload;\n    const operationListSQL = getOperationListSQL(rest);\n    return getBackendSrv().fetch({\n        url: '/api/ds/query',\n        method: 'POST',\n        data: {\n            queries: [\n                {\n                    refId: 'getOperationList',\n                    datasource: {\n                        type: 'mysql',\n                        uid: selectdbDS.uid,\n                    },\n                    rawSql: operationListSQL,\n                    format: 'table',\n                },\n            ],\n        },\n        credentials: 'include',\n    });\n}\n\n\n\n","import { DEFAULT_OPERATION, DEFAULT_SERVICE } from '../constants';\nimport { atom } from 'jotai';\n\n\nexport const currentTraceTableAtom = atom<string>('');\nexport const currentServiceAtom = atom<any>(DEFAULT_SERVICE);\nexport const currentOperationAtom = atom<any>(DEFAULT_OPERATION);\nexport const currentSortAtom = atom<any>('most-recent');\nexport const tagsAtom = atom<string>('');\nexport const tracesAtom = atom<any>([]);\nexport const tracesServicesAtom = atom<any>([]);\nexport const traceOperationsAtom = atom<any>([]);\nexport const minDurationAtom = atom<any>('');\nexport const maxDurationAtom = atom<any>('');\n","import { atom } from 'jotai';\nimport { atomWithStorage, selectAtom } from 'jotai/utils';\n// import { focusAtom } from 'jotai-optics'\nimport { atomWithLocation } from 'jotai-location';\nimport { DataSourceInstanceSettings, DataSourceJsonData } from '@grafana/data';\nimport { Dayjs } from 'dayjs';\nimport { DataFilterType, DiscoverCurrent, IntervalEnum, ShortcutItem } from 'types/type';\nimport { AggregatableEnum, DISCOVER_DEFAULT_STATUS, DISCOVER_SHORTCUTS, FieldTypeEnum, SearchableEnum } from 'utils/data';\n\nexport const locationAtom = atomWithLocation();\nexport const dataFilterAtom = atom<DataFilterType[]>([]);\nexport const discoverCurrentAtom = atom<DiscoverCurrent>(DISCOVER_DEFAULT_STATUS);\n\n// databases\nexport const databasesAtom = atom<any>([]);\nexport const tablesAtom = atom<any>([]);\n\nexport const currentCatalogAtom = atom('internal');\nexport const searchTypeAtom = atom<'SQL' | 'Search' | 'Lucene'>('Lucene');\nexport const currentDatabaseAtom = selectAtom(discoverCurrentAtom, current => current.database);\nexport const currentTableAtom = atom<string>('');\nexport const currentClusterAtom = atom('');\nexport const currentTimeFieldAtom = selectAtom(discoverCurrentAtom, current => current.timeField);\nexport const currentDateAtom = atom<Dayjs[]>(DISCOVER_SHORTCUTS[2].range());\nexport const currentIndexAtom = atom<any>([]);\nexport const selectedIndexesAtom = atom<any>([]);\nexport const searchValueAtom = atom('');\nexport const searchFocusAtom = atom(false);\nexport const activeShortcutAtom = atom<ShortcutItem | undefined>(DISCOVER_SHORTCUTS[2]);\nexport const dorisInfoAtom = atom<any>({});\nexport const disabledOptionsAtom = atom<string[]>([]);\n\nexport const selectedFieldsAtom = atom<any[]>([]);\nexport const tableFieldsAtom = atom<any[]>([]);\n\nexport const timeFieldsAtom = atom<any[]>([]);\nexport const tableDataAtom = atom<any[]>([]);\nexport const topDataAtom = atom<any[]>([]);\nexport const surroundingTableDataAtom = atom<any[]>([]);\nexport const tableDataChartsAtom = atom<any[]>([]);\nexport const intervalAtom = atom<IntervalEnum>(IntervalEnum.Auto);\nexport const tableTotalCountAtom = atom<number>(0);\nexport const tableEChartsDataAtom = atom<any[]>([]);\nexport const tableTracesDataAtom = atom<any>();\n\n// Filter Content Atom\nexport const searchableAtom = atom<SearchableEnum>(SearchableEnum.ANY);\nexport const aggregatableAtom = atom<AggregatableEnum>(AggregatableEnum.ANY);\nexport const fieldTypeAtom = atom<FieldTypeEnum>(FieldTypeEnum.ANY);\nexport const indexesAtom = atom<any[]>([]);\nexport const selectedRowAtom = atom<any>({});\nexport const tableFieldValuesAtom = atom<Array<{ label: string; value: string }>>([]);\n\nexport const pageAtom = atom<number>(1);\nexport const pageSizeAtom = atomWithStorage<number>('discover-pagination-size', 50);\n\n// Surrounding Data Atoms\nexport const surroundingDataFilterAtom = atom<DataFilterType[]>([]);\nexport const beforeTimeFieldPageSizeAtom = atom<number>(5);\nexport const afterTimeFieldPageSizeAtom = atom<number>(5);\nexport const beforeTimeAtom = atom<string>('');\nexport const afterTimeAtom = atom<string>('');\nexport const beforeCountAtom = atom<number>(0);\nexport const afterCountAtom = atom<number>(0);\nexport const surroundingTableFieldsAtom = atom<any[]>([]);\nexport const surroundingSelectedFieldsAtom = atom<any[]>([]);\n\nexport const datasourcesAtom = atom<Array<DataSourceInstanceSettings<DataSourceJsonData>>>([]);\nexport const selectedDatasourceAtom = atom<DataSourceInstanceSettings<DataSourceJsonData>>();\nexport const timeRangeAtom = atom<any>({\n    from: DISCOVER_SHORTCUTS[2].range()[0].toDate(),\n    to: DISCOVER_SHORTCUTS[2].range()[1].toDate(),\n    raw: DISCOVER_SHORTCUTS[2].raw,\n});\n\n\nexport const discoverLoadingAtom = atom({\n    getTableData: false,\n    getTopData: false,\n    getSurroundingData: false,\n    getTableDataCharts: false,\n    getTableFieldValues: false,\n    getIndexes: false,\n    getTimeFields: false,\n    getTableFields: false,\n});\n","import { getAutoInterval } from '../constants';\nimport dayjs, { Dayjs, ManipulateType } from 'dayjs';\nimport { flatten, orderBy, some } from 'lodash-es';\nimport { nanoid } from 'nanoid';\nimport { DiscoverCurrent, DataFilterType, AutoInterval, IntervalEnum } from 'types/type';\nimport jsTokens from 'js-tokens';\nimport localeData from 'dayjs/plugin/localeData';\nimport { DataFrame, FieldType } from '@grafana/data';\nimport utc from 'dayjs/plugin/utc';\nimport { isIgnorableHighlightToken } from './utils';\ndayjs.extend(utc);\ndayjs.extend(localeData);\n\nexport const OPERATORS: string[] = [\n    '=',\n    '!=',\n    'in',\n    'not in',\n    'is null',\n    'is not null',\n    'like',\n    'not like',\n    'between',\n    'not between',\n    'match_any',\n    'match_all',\n    'match_phrase',\n    'match_phrase_prefix',\n];\nexport const SQL_OPERATORS: string[] = ['=', '!=', '>', '<', '>=', '<=', 'LIKE', 'IN', 'AND', 'OR', 'BETWEEN'];\nexport const TIME_FIELD_TYPES = ['DATETIME', 'DATE', 'DATETIMEV2', 'DATEV2', 'TIME'];\nexport function isValidTimeFieldType(fieldType: string): boolean {\n    // 提取基础字段类型（移除括号及其内容）\n    const baseFieldType = fieldType.split('(')[0];\n    return TIME_FIELD_TYPES.includes(baseFieldType);\n}\nexport const CAN_SEARCH_FIELD_TYPE = ['STRING', 'ARRAY', 'NUMBER', 'VARIANT'];\nexport const ENABLE_SEARCH_FIELD_TYPE = ['DATETIME', 'TIMESTAMP', 'TIME'];\nexport const getFieldType = (columnType: string | undefined) => {\n    if (!columnType) {\n        return '';\n    }\n    const currentColumnType = FIELD_TYPES.find(item => item.value.some(val => columnType.toLocaleUpperCase().includes(val)));\n    return currentColumnType?.key;\n};\n\nexport const DISCOVER_DEFAULT_STATUS: DiscoverCurrent = {\n    catalog: 'internal',\n    database: '',\n    table: '',\n    cluster: '',\n    timeField: '',\n    date: [],\n};\n\nexport enum SearchableEnum {\n    ANY = 'ANY',\n    YES = 'YES',\n    NO = 'NO',\n}\nexport enum AggregatableEnum {\n    ANY = 'ANY',\n    YES = 'YES',\n    NO = 'NO',\n}\n\nexport const SEARCHABLE = [\n    {\n        label: `Any`,\n        value: SearchableEnum.ANY,\n    },\n    {\n        label: 'Yes',\n        value: SearchableEnum.YES,\n    },\n    {\n        label: 'No',\n        value: SearchableEnum.NO,\n    },\n];\n\nexport const AGGREGATABLE = [\n    {\n        label: `Any`,\n        value: AggregatableEnum.ANY,\n    },\n    {\n        label: 'Yes',\n        value: AggregatableEnum.YES,\n    },\n    {\n        label: 'No',\n        value: AggregatableEnum.NO,\n    },\n];\n\nexport enum FieldTypeEnum {\n    ANY = 'ANY',\n    STRING = 'STRING',\n    NUMBER = 'NUMBER',\n    DATE = 'DATE',\n}\n\nexport enum ParamsKeyEnum {\n    sqlCatalog = 'sqlCatalog',\n    sqlDatabase = 'sqlDatabase',\n    startDate = 'startDateRange',\n    endDate = 'endDateRange',\n    sqlSearch = 'sqlSearch',\n    selectedTable = 'selectedTable',\n    dateInterval = 'dateInterval',\n    selectedField = 'selectedField',\n    dataFilter = 'dataFilter',\n    selectedTimeField = 'selectedTimeField',\n    sortedField = 'sortedField',\n    searchType = 'searchType',\n    selectedIndex = 'selectedIndex',\n    selectedCluster = 'selectedCluster',\n}\n\nexport function getFilterSQL({ fieldName, operator, value }: DataFilterType): string {\n    const valueString = value.map((e: any) => {\n        if (typeof e === 'string') {\n            return `'${e}'`;\n        } else {\n            return e;\n        }\n    });\n\n    if (\n        operator === '=' ||\n        operator === '!=' ||\n        operator === 'like' ||\n        operator === 'not like' ||\n        operator === 'match_all' ||\n        operator === 'match_any' ||\n        operator === 'match_phrase' ||\n        operator === 'match_phrase_prefix'\n    ) {\n        return `\\`${fieldName}\\` ${operator} ${valueString[0]}`;\n    }\n\n    if (operator === 'is null' || operator === 'is not null') {\n        return `\\`${fieldName}\\` ${operator}`;\n    }\n\n    if (operator === 'between' || operator === 'not between') {\n        return `\\`${fieldName}\\` ${operator} ${valueString[0]} AND ${valueString[1]}`;\n    }\n\n    if (operator === 'in' || operator === 'not in') {\n        return `\\`${fieldName}\\` ${operator} (${valueString})`;\n    }\n\n    return '';\n}\n\nexport function addSqlFilter(sql: string, dataFilterValue: DataFilterType): string {\n    let result = sql;\n    if (!sql.toUpperCase().includes('WHERE')) {\n        result += ' WHERE';\n    } else {\n        result += ' AND';\n    }\n\n    result += ` (${getFilterSQL(dataFilterValue)})`;\n\n    return result;\n}\n\nfunction isWrappedInQuotes(inputString: string): boolean {\n    const pattern = /([\"'])(.*?)\\1/;\n    return pattern.test(inputString);\n}\n\nexport function getIndexesStatement(indexes: any[], allField: any[], keywords: string) {\n    let operator: 'MATCH_ANY' | 'MATCH_PHRASE' | 'MATCH_PHRASE_PREFIX' | '=' = 'MATCH_ANY';\n\n    let searchValue = keywords.trim();\n\n    if (!searchValue || !indexes) {\n        return '';\n    }\n\n    if (isWrappedInQuotes(keywords)) {\n        operator = 'MATCH_PHRASE';\n    } else {\n        searchValue = `'${searchValue}'`;\n    }\n    const indexesNames = indexes.map(item => item.columnName);\n    return indexesNames.reduce((prevValue, currValue) => {\n        const currentField = allField.find(field => `${field.value}` === currValue);\n        const currentFieldType = getFieldType(currentField.Type)?.toUpperCase();\n        if (currentFieldType === 'NUMBER') {\n            operator = '=';\n        }\n        if (currentFieldType === 'STRING' || currentFieldType === 'ARRAY') {\n            if (isWrappedInQuotes(keywords)) {\n                operator = 'MATCH_PHRASE';\n            } else {\n                operator = 'MATCH_ANY';\n            }\n        }\n        const canSearchField = CAN_SEARCH_FIELD_TYPE.includes(currentFieldType as string);\n        if (canSearchField) {\n            if (prevValue) {\n                return `${prevValue} OR \\`${currValue}\\` ${operator} ${searchValue}`;\n            } else {\n                return `\\`${currValue}\\` ${operator} ${searchValue}`;\n            }\n        }\n        return prevValue;\n    }, '');\n}\n\nexport const DISCOVER_SHORTCUTS = [\n    {\n        key: nanoid(),\n        text: `Last 5 Minutes`,\n        label: `Last 5 Minutes`,\n        range: (now: dayjs.Dayjs = dayjs()) => [now.add(-5, 'minute').startOf('second'), now],\n        format: 'HH:mm',\n        raw: {\n            from: 'now-5m',\n            to: 'now',\n        },\n        type: 'minute',\n        number: -5,\n    },\n    {\n        key: nanoid(),\n        text: `Last 15 Minutes`,\n        label: `Last 15 Minutes`,\n        raw: {\n            from: 'now-15m',\n            to: 'now',\n        },\n        range: (now: dayjs.Dayjs = dayjs()) => [now.add(-15, 'minute').startOf('second'), now],\n        format: 'HH:mm',\n        type: 'minute',\n        number: -15,\n    },\n    {\n        key: nanoid(),\n        text: `Last 1 Hour`,\n        label: `Last 1 Hour`,\n        raw: {\n            from: 'now-1h',\n            to: 'now',\n        },\n        range: (now: dayjs.Dayjs = dayjs()) => [now.add(-1, 'hour').startOf('second'), now],\n        format: 'HH:mm',\n        type: 'hour',\n        number: -1,\n    },\n    {\n        key: nanoid(),\n        text: `Last 1 Day`,\n        label: `Last 1 Day`,\n        raw: {\n            from: 'now-1d',\n            to: 'now',\n        },\n        range: (now: dayjs.Dayjs = dayjs()) => [now.add(-1, 'day').startOf('second'), now],\n        format: 'HH:mm',\n        type: 'day',\n        number: -1,\n    },\n    {\n        key: nanoid(),\n        text: `Last 7 Days`,\n        label: `Last 1 Days`,\n        raw: {\n            from: 'now-7d',\n            to: 'now',\n        },\n        range: (now: dayjs.Dayjs = dayjs()) => [now.add(-7, 'day').startOf('second'), now],\n        format: 'HH:mm',\n        type: 'day',\n        number: -7,\n    },\n    {\n        key: nanoid(),\n        text: `Last 1 Month`,\n        label: `Last 1 Month`,\n        raw: {\n            from: 'now-1M',\n            to: 'now',\n        },\n        range: (now: dayjs.Dayjs = dayjs()) => [now.add(-1, 'month').startOf('second'), now],\n        format: 'HH:mm',\n        type: 'month',\n        number: -1,\n    },\n    {\n        key: nanoid(),\n        text: `Last 3 Months`,\n        label: `Last 3 Months`,\n        raw: {\n            from: 'now-3M',\n            to: 'now',\n        },\n        range: (now: dayjs.Dayjs = dayjs()) => [now.add(-3, 'month').startOf('second'), now],\n        format: 'HH:mm',\n        type: 'month',\n        number: -3,\n    },\n    {\n        key: nanoid(),\n        text: `Last 1 Year`,\n        label: `Last 1 Year`,\n        raw: {\n            from: 'now-1y',\n            to: 'now',\n        },\n        range: (now: dayjs.Dayjs = dayjs()) => [now.add(-1, 'year').startOf('second'), now],\n        format: 'HH:mm',\n        type: 'year',\n        number: -1,\n    },\n];\n\nexport const SURROUNDING_LOGS_OPERATORS = [\n    {\n        label: '5',\n        value: '5',\n    },\n    {\n        label: '10',\n        value: '10',\n    },\n];\n\nexport function getLatestTime(id: string) {\n    if (!id) {\n        return null;\n    }\n    const selectedItem = DISCOVER_SHORTCUTS.find(item => item.key === id);\n    return selectedItem?.range();\n}\n\nexport const TIME_INTERVALS = [\n    {\n        value: 'auto',\n        label: `Auto`,\n    },\n    {\n        value: 'second',\n        label: `Second`,\n    },\n    {\n        value: 'minute',\n        label: `Minute`,\n    },\n    {\n        value: 'hour',\n        label: `Hour`,\n    },\n    {\n        value: 'day',\n        label: `Day`,\n    },\n    {\n        value: 'week',\n        label: `Week`,\n    },\n    {\n        value: 'month',\n        label: `Month`,\n    },\n    {\n        value: 'year',\n        label: `Year`,\n    },\n];\n\nexport const PAGESIZE_OPTIONS = [10, 20, 50, 100, 200];\n\nexport const FIELD_TYPES = [\n    {\n        key: 'STRING',\n        value: ['VARCHAR', 'STRING', 'CHAR', 'TEXT'],\n        icon: '',\n    },\n    {\n        key: 'NUMBER',\n        value: ['INT', 'LARGEINT', 'SMALLINT', 'TINYINT', 'DECIMAL', 'BIGINT', 'FLOAT', 'DOUBLE'],\n        icon: '',\n    },\n    {\n        key: 'DATE',\n        value: ['DATE', 'DATETIME', 'DATEV2', 'DATETIMEV2'],\n        icon: '',\n    },\n    {\n        key: 'JSONB',\n        value: ['JSONB'],\n        icon: '',\n        complex: true,\n    },\n    {\n        key: 'ARRAY',\n        value: ['ARRAY'],\n        icon: '',\n        complex: true,\n    },\n    {\n        key: 'BOOLEAN',\n        value: ['BOOLEAN'],\n        icon: '',\n    },\n    {\n        key: 'BITMAP',\n        value: ['BITMAP'],\n        icon: '',\n        complex: true,\n    },\n    {\n        key: 'HLL',\n        value: ['HLL'],\n        icon: '',\n        complex: true,\n    },\n    {\n        key: 'VARIANT',\n        value: ['VARIANT'],\n        icon: '',\n        complex: true,\n    },\n    {\n        key: 'JSON',\n        value: ['JSON'],\n        icon: '',\n        complex: true,\n    },\n];\n\nexport function encodeBase64(str: string) {\n    return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g, (match, p1) => String.fromCharCode(parseInt('0x' + p1, 10))));\n}\n\nexport function decodeBase64(base64: string) {\n    return decodeURIComponent(\n        Array.from(atob(base64))\n            .map(c => '%' + c.charCodeAt(0).toString(16).padStart(2, '0'))\n            .join(''),\n    );\n}\n\nexport const isComplexType = (columnType: string | undefined) => {\n    if (!columnType) {\n        return false;\n    }\n    const currentColumnType = FIELD_TYPES.find(item => item.value.some(val => columnType.toLocaleUpperCase().includes(val)));\n    if (currentColumnType) {\n        return !!currentColumnType.complex;\n    }\n    return true;\n};\n\nexport function formatDate(interval: ManipulateType) {\n    let date_format = 'YYYY-MM-DD HH:mm:ss';\n    switch (interval) {\n        case 'year':\n            date_format = 'YYYY';\n            break;\n        case 'month':\n            date_format = 'YYYY-MM';\n            break;\n        case 'week':\n            date_format = 'YYYY-MM-DD';\n            break;\n        case 'day':\n            date_format = 'YYYY-MM-DD';\n            break;\n        case 'hour':\n            date_format = 'YYYY-MM-DD HH:mm:ss';\n            break;\n        case 'minute':\n            date_format = 'YYYY-MM-DD HH:mm:ss';\n            break;\n        case 'second':\n        default:\n            date_format = 'YYYY-MM-DD HH:mm:ss';\n            break;\n    }\n    return date_format;\n}\n\nexport function resetDate(date: Dayjs, interval: ManipulateType) {\n    let date_reset = date;\n    switch (interval) {\n        case 'year':\n            date_reset.set('month', 1).set('date', 1).set('hour', 0).set('minute', 0).set('second', 0);\n            break;\n        case 'month':\n            date_reset.set('date', 1).set('hour', 0).set('minute', 0).set('second', 0);\n            break;\n        case 'week':\n            date_reset.set('hour', 0).set('minute', 0).set('second', 0);\n            break;\n        case 'day':\n            date_reset.set('hour', 0).set('minute', 0).set('second', 0);\n            break;\n        case 'hour':\n            date_reset.set('minute', 0).set('second', 0);\n            break;\n        case 'minute':\n            date_reset.set('second', 0);\n            break;\n        case 'second':\n        default:\n            break;\n    }\n    return date_reset;\n}\n\nexport function getDateRange(startDate: Dayjs, endDate: Dayjs, interval: any) {\n    const DATE_FORMAT = formatDate(interval.interval_unit);\n    if (dayjs(startDate, DATE_FORMAT).isSame(dayjs(endDate, DATE_FORMAT), interval.interval_unit)) {\n        return [endDate];\n    }\n    let date: any = resetDate(startDate, interval.interval_unit);\n    const formatStartDate = date.format(DATE_FORMAT);\n    const dates = [formatStartDate];\n    do {\n        date = dayjs(date).add(interval.interval_value, interval.interval_unit);\n        if (dayjs(date).isBefore(endDate)) {\n            dates.push(date.format(DATE_FORMAT));\n        }\n    } while (dayjs(date).isBefore(endDate));\n    return dates;\n}\n\nexport function getChartsData(tableDataCharts: any[], currentDate: [Dayjs, Dayjs]) {\n    const selectInterval: AutoInterval = getAutoInterval(currentDate);\n    const [startDate, endDate] = currentDate;\n    const intervalUnit: any = selectInterval.interval_unit || IntervalEnum.Auto;\n    const timeInterval: any = intervalUnit === IntervalEnum.Auto ? selectInterval : { interval_value: 1, interval_unit: intervalUnit };\n    const dates = getDateRange(startDate as Dayjs, endDate as Dayjs, timeInterval);\n    const tableDataMap = new Map();\n    const result: any[] = [];\n    const DATE_FORMAT_FROM_INTERVAL = formatDate(timeInterval.interval_unit);\n\n    tableDataCharts.forEach(e => {\n        const currentLocale = dayjs.locale();\n        const date = dayjs.utc(e['TT']).locale(currentLocale).format(DATE_FORMAT_FROM_INTERVAL);\n        tableDataMap.set(date, e['sum(cnt)']);\n    });\n    dates.forEach(date => {\n        const newDate = dayjs(date).format(DATE_FORMAT_FROM_INTERVAL);\n        if (!tableDataMap.get(newDate)) {\n            tableDataMap.set(newDate, null);\n        }\n    });\n\n    tableDataMap.forEach((value, key) => {\n        result.push({\n            TT: key,\n            ['sum(cnt)']: value,\n        });\n    });\n    return orderBy(result, ['TT'], ['asc']);\n}\n\nexport function convertColumnToRow(frame: any): Array<Record<string, any>> {\n    const fieldNames = frame.schema.fields.map((f: any) => f.name);\n    const columns = frame.data.values;\n\n    if (columns.length === 0) {\n        return [];\n    }\n\n    const numRows = columns[0].length;\n    const rows: Array<Record<string, any>> = [];\n\n    for (let i = 0; i < numRows; i++) {\n        const row: Record<string, any> = {};\n        for (let j = 0; j < columns.length; j++) {\n            row[fieldNames[j]] = columns[j][i];\n            if (isValidTimeFieldType(frame.schema.fields[j].type.toUpperCase())) {\n                // 如果是时间字段，转换为 Dayjs 对象\n                row[fieldNames[j]] = formatTimestampToDateTime(row[fieldNames[j]], frame.schema.fields[j].precision || 3);\n            }\n            if (frame.schema.fields[j].type === 'VARIANT') {\n                // 如果是 VARIANT 类型，转换为 JSON 对象\n                try {\n                    row[fieldNames[j]] = JSON.parse(row[fieldNames[j]]);\n                } catch (e) {\n                    console.error(`Error parsing VARIANT field ${fieldNames[j]}:`, e);\n                }\n            }\n        }\n        rows.push(row);\n    }\n\n    return rows;\n}\n\n// 通过查询 Doris 的字段判断类型，不依赖 Grafana 类型\nexport function convertColumnToRowViaFieldsType(frame: any, fields: any): Array<Record<string, any>> {\n    const fieldNames = frame.schema.fields.map((f: any) => f.name);\n    const columns = frame.data.values;\n\n    if (columns.length === 0) {\n        return [];\n    }\n\n    const numRows = columns[0].length;\n    const rows: Array<Record<string, any>> = [];\n\n    for (let i = 0; i < numRows; i++) {\n        const row: Record<string, any> = {};\n        for (let j = 0; j < columns.length; j++) {\n            row[fieldNames[j]] = columns[j][i];\n            if (isValidTimeFieldType(frame.schema.fields[j].type.toUpperCase())) {\n                // 如果是时间字段，转换为 Dayjs 对象\n                row[fieldNames[j]] = formatTimestampToDateTime(row[fieldNames[j]], frame.schema.fields[j].precision || 3);\n                // row[fieldNames[j]] = dayjs.utc(row[fieldNames[j]]).locale(currentLocale).format('YYYY-MM-DD HH:mm:ss.SSS');\n            }\n            const currentFieldInfo = fields.filter((item: any) => item.Field === frame.schema.fields[j].name)[0];\n            // 如果是 VARIANT 类型，转换为 JSON 对象\n            if (currentFieldInfo && currentFieldInfo.Type.toUpperCase() === 'VARIANT') {\n                try {\n                    row[fieldNames[j]] = JSON.parse(row[fieldNames[j]]);\n                } catch (e) {\n                    console.error(`Error parsing VARIANT field ${fieldNames[j]}:`, e);\n                }\n            }\n        }\n        rows.push(row);\n    }\n\n    return rows;\n}\n\n// 格式化时间戳为 DATETIME([number]) 格式\nexport function formatTimestampToDateTime(timestamp: any, precision = 3) {\n    const currentLocale = dayjs.locale();\n    // 基础格式：YYYY-MM-DD HH:mm:ss\n    let formatString = 'YYYY-MM-DD HH:mm:ss';\n\n    // 根据精度添加毫秒部分\n    if (precision > 0) {\n        formatString += `.${'S'.repeat(precision)}`;\n    }\n    // 转换时间戳并格式化\n    return dayjs.utc(timestamp).locale(currentLocale).format(formatString);\n}\n\nexport function formatTracesResData(frame: any) {\n    const { data } = frame;\n    const traceDataFrame: DataFrame = {\n        name: 'Trace ID',\n        refId: frame.schema?.refId || 'Trace ID',\n        fields: frame.schema?.fields.map((f: any, i: number) => ({\n            name: f.name,\n            type: f.type,\n            values: data.values[i],\n            typeInfo: f.typeInfo,\n            config: {},\n        })),\n        length: data.values[0].length,\n    };\n    try {\n        traceDataFrame.fields.forEach(f => {\n            if (f.name === 'serviceTags' || f.name === 'tags') {\n                f.type = FieldType.other;\n                f.values = f.values.map(item => JSON.parse(item));\n            }\n        });\n    } catch (err) {\n        console.log('err:', err);\n    }\n    console.log('traceDataFrame', traceDataFrame);\n    return traceDataFrame;\n}\n\nfunction getSearchTableData(tokenizeFields: any[], tableResult: any[]) {\n    const result: any = [...tokenizeFields];\n    tableResult.forEach(tableItem => {\n        result.forEach((token: any) => {\n            token['searchValue'] = tableItem[token.columnName];\n        });\n    });\n    return result;\n}\n\nfunction searchField(data: any[], searchString: string) {\n    return some(data, item => item.columnName === searchString);\n}\n\nfunction parseKeywords(keyword: string) {\n    if (keyword.length >= 2 && keyword[0] === keyword[keyword.length - 1] && (keyword[0] === `'` || keyword[0] === `\"`)) {\n        keyword = keyword.substring(1, keyword.length - 1);\n    }\n    return keyword;\n}\n\nfunction highlightDelimiter(inputStr: string, delimiter: string) {\n    const highlighted = inputStr.replace(new RegExp(`${delimiter}`, 'g'), `<mark>${delimiter}</mark>`);\n    return highlighted;\n}\n\nfunction insertUnderscore(arr: string[]) {\n    return arr.reduce((result: string[], item: string, index) => {\n        result.push(item);\n        if (index < arr.length - 1) {\n            result.push('_');\n        }\n        return result;\n    }, []);\n}\n\nfunction compare_ignore_quotes(s1: string, s2: string) {\n    // 移除双引号和单引号\n    const cleanS1 = s1.replace(/['\"]/g, '');\n    const cleanS2 = s2.replace(/['\"]/g, '');\n    // 比较\n    return cleanS1 === cleanS2;\n}\n\ntype SearchResultItem = { [key: string]: any };\nexport function generateHighlightedResults(data: { search_value: string; indexes: string[] }, result: SearchResultItem[]) {\n    const keyword: string = data.search_value || '';\n    const searchTableData = getSearchTableData(data.indexes, result);\n\n    const keywordsTokens: string[] = flatten(\n        Array.from(jsTokens(keyword))\n            .filter(item => item.type !== 'Punctuator')\n            .map(item => {\n                let res = item.value.toLowerCase();\n                return item.value.includes('_') ? item.value.split('_').map(str => str.toLowerCase()) : res;\n            }),\n    );\n\n    const _sourceResult = result.map(item => {\n        let itemSource = '';\n\n        for (const key in item) {\n            let highlightValue: any = item[key];\n            let itemValue: any = item[key];\n\n            if (typeof highlightValue === 'object') {\n                highlightValue = JSON.stringify(highlightValue);\n                itemValue = JSON.stringify(itemValue);\n            }\n\n            if (keyword && searchField(searchTableData, key)) {\n                const strValue = typeof itemValue === 'string' ? itemValue : itemValue + '';\n\n                if (isWrappedInQuotes(keyword)) {\n                    const parsedKeyword = parseKeywords(keyword);\n                    if (parsedKeyword === strValue) {\n                        highlightValue = `<mark>${itemValue}</mark>`;\n                    } else if (strValue.includes(parsedKeyword)) {\n                        highlightValue = highlightDelimiter(strValue, parsedKeyword);\n                    }\n                } else {\n                    const tokenizedAns = Array.from(jsTokens(strValue)).map(item => item.value);\n                    let ans: string[] = [];\n\n                    if (tokenizedAns.includes(keyword)) {\n                        ans = tokenizedAns;\n                    } else {\n                        const ansWithUnderscore = flatten(\n                            tokenizedAns.map(item => {\n                                if (item.includes('_')) {\n                                    return insertUnderscore(item.split('_'));\n                                }\n                                return item;\n                            }),\n                        );\n                        ans = ansWithUnderscore;\n                    }\n\n                    if (ans.length > 0) {\n                        highlightValue = ans.reduce((acc: string, curr: string) => {\n                            if (\n                                keywordsTokens.filter(token => !isIgnorableHighlightToken(token)).find(token => compare_ignore_quotes(token, curr.toLowerCase())) ||\n                                compare_ignore_quotes(keyword.toLowerCase(), curr.toLowerCase())\n                            ) {\n                                return acc + `<mark>${curr}</mark>`;\n                            }\n                            return acc + curr;\n                        }, '');\n                    }\n                }\n            }\n\n            // ✅ 这里改成用 data-trace-id + class，方便事件委托识别\n            if (key === 'trace_id') {\n                const traceId = typeof itemValue === 'string' ? itemValue : String(itemValue);\n\n                const content = highlightValue || traceId;\n\n                highlightValue = `<a \n                href=\"javascript:void(0)\" \n                class=\"trace-link\" \n                data-trace-id=\"${traceId}\"\n            >${content}</a>`;\n            }\n\n            itemSource += `<span class=\"field-key\">${key}:</span>${highlightValue} `;\n        }\n\n        return {\n            _original: item,\n            _source: itemSource.trim(),\n        };\n    });\n\n    return _sourceResult;\n}\n","import dayjs, { Dayjs, ManipulateType } from \"dayjs\";\n\nexport interface QueryTableDataParams {\n    catalog: string;\n    database: string;\n    table: string;\n    cluster: string;\n    startDate: string;\n    endDate: string;\n    sort: string;\n    timeField: string;\n    data_filters: any[];\n    interval?: IntervalEnum;\n    interval_value?: number;\n    search_type: string;\n    search_value: string;\n    indexes?: string;\n    indexes_statement?: string;\n    page: string;\n    page_size: number;\n    lucene_where?: string;\n}\n\n\nexport interface SurroundingParams {\n    catalog: string;\n    database: string;\n    table: string;\n    cluster: string;\n    timeField: string;\n    time: string;\n    data_filters: any;\n    pageSize: string;\n    operator: '>' | '<';\n    theme: string | undefined;\n}\n\nexport interface DataFilterType {\n    fieldName: string;\n    operator: Operator;\n    value: Array<string | number>;\n    label?: string;\n    id: string;\n}\n\nexport type Operator =\n    | '='\n    | '!='\n    | 'in'\n    | 'not in'\n    | 'is null'\n    | 'is not null'\n    | 'between'\n    | 'not between'\n    | 'like'\n    | 'not like'\n    | 'match_all'\n    | 'match_any'\n    | 'match_phrase'\n    | 'match_phrase_prefix';\n\nexport interface DiscoverCurrent {\n    catalog: string;\n    database: string;\n    table: string;\n    cluster: string;\n    timeField: string;\n    date: [Dayjs, Dayjs] | [];\n}\n\nexport enum IntervalEnum {\n    Auto = 'auto',\n    Day = 'day',\n    Week = 'week',\n    Month = 'month',\n    Year = 'year',\n    Hour = 'hour',\n    Minute = 'minute',\n    Second = 'second',\n}\n\n\nexport type ShortcutItem = {\n    key: string;\n    text: string;\n    label: string;\n    range: (now?: dayjs.Dayjs) => dayjs.Dayjs[];\n    format: string;\n    type: string;\n    number: number;\n}\n\nexport interface QueryTableFieldsParams {\n    catalog: string;\n    database: string;\n    table: string;\n    describe_extend_variant_column?: string;\n}\n\nexport type FieldNode = {\n    name: string;\n    type: string;\n    children?: FieldNode[];\n    Null?: string;\n    Key?: string;\n    Default?: string | null;\n    Extra?: string;\n    Comment?: string;\n    Visible?: string;\n};\n\n\nexport interface RequestParams {\n    catalog: string;\n    database: string;\n    table: string;\n    describe_extend_variant_column?: boolean;\n}\n\nexport interface QueryTableIndexesParams {\n    catalog: string;\n    database: string;\n    table: string\n}\n\nexport interface QueryTableParams {\n    catalog: string;\n    database: string;\n}\n\nexport type AutoInterval = {\n    current_date_range: number;\n    current_type: ManipulateType;\n    interval_unit: ManipulateType;\n    interval_value: number;\n};\n\n\nexport type Frame = {\n    schema: {\n        fields: Array<{ name: string }>;\n    };\n    data: {\n        values: any[][];\n    };\n};\n\nexport type Result = {\n    frames: Frame[];\n};\n\nexport type Root = {\n    results: Record<string, Result>;\n};\n\nexport type QueryTracesParams = {\n    database: string;\n    table: string;\n    timeField: string;\n    startDate: string;\n    endDate: string;\n    service_name?: string;\n    operation?: string;\n    statusCode?: string;\n    minDuration?: string;\n    maxDuration?: string;\n    tags?: string;\n    page?: number;\n    page_size?: number;\n    sortBy?: string;\n};\n\nexport type TracesServicesParams = {\n  table: string;\n  timeField: string;\n  startDate: string;\n  endDate: string;\n};\n\nexport type TracesOperationsParams = {\n  table: string;\n  timeField: string;\n  startDate: string;\n  endDate: string;\n  service_name: string;\n};\n","import { toDataFrame } from '@grafana/data';\nimport { getBackendSrv } from '@grafana/runtime';\nimport { lastValueFrom } from 'rxjs';\n\ntype GetColumnParams = {\n    connectionId: string;\n    database: string;\n    table: string;\n    column: string;\n    datasourceType?: string;\n};\n\ntype ColumnMetadata = {\n    name: string;\n    dataType?: string;\n    columnType?: string;\n};\n\ntype GetIndexesParams = {\n    connectionId: string;\n    database: string;\n    table: string;\n    datasourceType?: string;\n};\n\nconst escapeSqlLiteral = (value: string) => value.replace(/'/g, \"''\");\n\nconst normalizeColumnType = ({ dataType, columnType }: { dataType?: string; columnType?: string }): string => {\n    const source = (columnType || dataType || '').trim();\n    if (!source) {\n        return '';\n    }\n\n    const lower = source.toLowerCase();\n\n    if (lower.startsWith('nullable(') && lower.endsWith(')')) {\n        const inner = source.slice(9, -1);\n        const normalizedInner = normalizeColumnType({ dataType: inner, columnType: undefined });\n        return normalizedInner ? `Nullable(${normalizedInner})` : source;\n    }\n\n    if (lower.startsWith('map')) {\n        return source.replace(/^map/i, 'Map');\n    }\n\n    if (lower.startsWith('array')) {\n        return source.replace(/^array/i, 'Array');\n    }\n\n    if (lower.startsWith('json') || lower.startsWith('variant')) {\n        return 'JSON';\n    }\n\n    if (lower === 'bool' || lower === 'boolean' || lower.startsWith('tinyint(1)')) {\n        return 'Bool';\n    }\n\n    if (lower.startsWith('tinyint')) {\n        return 'Int8';\n    }\n\n    if (lower.startsWith('smallint')) {\n        return 'Int16';\n    }\n\n    if (lower.startsWith('mediumint')) {\n        return 'Int32';\n    }\n\n    if (lower.startsWith('bigint') || lower.startsWith('int') || lower.startsWith('integer')) {\n        return 'Int64';\n    }\n\n    if (lower.startsWith('float') || lower.startsWith('double') || lower.startsWith('real')) {\n        return 'Float64';\n    }\n\n    if (lower.startsWith('decimal') || lower.startsWith('numeric')) {\n        return 'Float64';\n    }\n\n    if (lower.startsWith('date')) {\n        return source.replace(/^date/i, 'Date');\n    }\n\n    if (lower.startsWith('timestamp') || lower.startsWith('datetime')) {\n        return 'DateTime';\n    }\n\n    if (lower.startsWith('enum')) {\n        return source.replace(/^enum/i, 'Enum');\n    }\n\n    if (lower.startsWith('uuid')) {\n        return 'UUID';\n    }\n\n    if (lower.startsWith('ipv4')) {\n        return 'IPv4';\n    }\n\n    if (lower.startsWith('ipv6')) {\n        return 'IPv6';\n    }\n\n    if (lower.startsWith('tuple')) {\n        return source.replace(/^tuple/i, 'Tuple');\n    }\n\n    if (lower.startsWith('struct')) {\n        return source.replace(/^struct/i, 'Tuple');\n    }\n\n    if (lower.startsWith('char') || lower.startsWith('varchar') || lower.startsWith('text') || lower.startsWith('string')) {\n        return 'String';\n    }\n\n    return source;\n};\n\nexport async function getColumn({\n    connectionId,\n    database,\n    table,\n    column,\n    datasourceType = 'mysql',\n}: GetColumnParams): Promise<(ColumnMetadata & { normalizedType: string }) | null> {\n    if (!connectionId || !database || !table || !column) {\n        return null;\n    }\n\n    const query = `\nSELECT\n  COLUMN_NAME AS Field,\n  DATA_TYPE AS DataType,\n  COLUMN_TYPE AS ColumnType\nFROM information_schema.COLUMNS\nWHERE TABLE_SCHEMA = '${escapeSqlLiteral(database)}'\n  AND TABLE_NAME = '${escapeSqlLiteral(table)}'\n  AND COLUMN_NAME = '${escapeSqlLiteral(column)}'\nLIMIT 1;\n`;\n\n    const response$ = getBackendSrv().fetch({\n        url: '/api/ds/query',\n        method: 'POST',\n        data: {\n            queries: [\n                {\n                    refId: 'getColumn',\n                    datasource: { type: datasourceType, uid: connectionId },\n                    rawSql: query,\n                    format: 'table',\n                },\n            ],\n        },\n    });\n\n    try {\n        const { data, ok } = await lastValueFrom(response$);\n        if (!ok) {\n            return null;\n        }\n\n        const resultData = data as { results?: Record<string, any> };\n        const frame = resultData?.results?.getColumn?.frames?.[0];\n        if (!frame) {\n            return null;\n        }\n\n        const dataFrame = toDataFrame(frame);\n        const nameField = dataFrame.fields.find(field => field.name === 'Field') ?? dataFrame.fields[0];\n        const dataTypeField = dataFrame.fields.find(field => field.name === 'DataType');\n        const columnTypeField = dataFrame.fields.find(field => field.name === 'ColumnType');\n\n        const name = nameField?.values?.get?.(0);\n        if (!name) {\n            return null;\n        }\n\n        const dataTypeValue = dataTypeField?.values?.get?.(0);\n        const columnTypeValue = columnTypeField?.values?.get?.(0);\n\n        const columnInfo: ColumnMetadata = {\n            name: String(name),\n            dataType: dataTypeValue != null ? String(dataTypeValue) : undefined,\n            columnType: columnTypeValue != null ? String(columnTypeValue) : undefined,\n        };\n\n        const normalizedType = normalizeColumnType({\n            dataType: columnInfo.dataType,\n            columnType: columnInfo.columnType,\n        });\n\n        return {\n            ...columnInfo,\n            normalizedType,\n        };\n    } catch (error) {\n        console.error('Failed to fetch column metadata', error);\n        return null;\n    }\n}\n\nexport async function getInvertedIndexColumns({\n    connectionId,\n    database,\n    table,\n    datasourceType = 'mysql',\n}: GetIndexesParams): Promise<string[]> {\n    if (!connectionId || !database || !table) {\n        return [];\n    }\n\n    const query = `SHOW INDEXES FROM \\`${database}\\`.\\`${table}\\``;\n\n    const response$ = getBackendSrv().fetch({\n        url: '/api/ds/query',\n        method: 'POST',\n        data: {\n            queries: [\n                {\n                    refId: 'getInvertedIndexes',\n                    datasource: { type: datasourceType, uid: connectionId },\n                    rawSql: query,\n                    format: 'table',\n                },\n            ],\n        },\n    });\n\n    try {\n        const { data, ok } = await lastValueFrom(response$);\n        if (!ok) {\n            return [];\n        }\n\n        const resultData = data as { results?: Record<string, any> };\n        const frame =\n            resultData?.results?.getInvertedIndexes?.frames?.[0] ??\n            resultData?.results?.getIndexes?.frames?.[0];\n\n        if (!frame) {\n            return [];\n        }\n\n        const dataFrame = toDataFrame(frame);\n        const columnNameField =\n            dataFrame.fields.find(field => field.name === 'Column_name') ??\n            dataFrame.fields.find(field => field.name === 'COLUMN_NAME');\n        const indexTypeField =\n            dataFrame.fields.find(field => field.name === 'Index_type') ??\n            dataFrame.fields.find(field => field.name === 'INDEX_TYPE');\n\n        if (!columnNameField || !indexTypeField) {\n            return [];\n        }\n\n        const columnNames = Array.from(columnNameField.values ?? []);\n        const indexTypes = Array.from(indexTypeField.values ?? []);\n        const indexedColumns = new Set<string>();\n\n        for (let i = 0; i < columnNames.length; i += 1) {\n            const columnName = columnNames[i];\n            const indexType = indexTypes[i];\n            if (typeof columnName !== 'string' || columnName.length === 0) {\n                continue;\n            }\n            if (typeof indexType !== 'string') {\n                continue;\n            }\n\n            if (indexType.toUpperCase().includes('INVERT')) {\n                indexedColumns.add(columnName);\n            }\n        }\n\n        return Array.from(indexedColumns);\n    } catch (error) {\n        console.error('Failed to fetch inverted index metadata', error);\n        return [];\n    }\n}\n\n\nexport function getDatabases(selectdbDS: any) {\n    const response$ = getBackendSrv().fetch({\n        url: '/api/ds/query',\n        method: 'POST',\n        data: {\n            queries: [\n                {\n                    refId: 'getDatabases',\n                    datasource: {\n                        type: 'mysql',\n                        uid: selectdbDS.uid,\n                    },\n                    rawSql: 'SHOW DATABASES',\n                    format: 'table',\n                },\n            ],\n        },\n    });\n    return response$;\n}\n\nexport function getTablesService({ selectdbDS, database }: { selectdbDS: any; database: string }) {\n    return getBackendSrv().fetch({\n        url: '/api/ds/query',\n        method: 'POST',\n        data: {\n            queries: [\n                {\n                    refId: 'getTables',\n                    datasource: { type: 'mysql', uid: selectdbDS.uid },\n                    rawSql: `SHOW TABLES FROM \\`${database}\\``,\n                    format: 'table',\n                },\n            ],\n        },\n    });\n}\n\nexport function getFieldsService({ selectdbDS, database, table }: { selectdbDS: any; database: string; table: string }) {\n    return getBackendSrv().fetch({\n        url: '/api/ds/query',\n        method: 'POST',\n        data: {\n            queries: [\n                {\n                    refId: 'getFields',\n                    datasource: { type: 'mysql', uid: selectdbDS.uid },\n                    rawSql: `SHOW COLUMNS FROM \\`${database}\\`.\\`${table}\\``,\n                    format: 'table',\n                },\n            ],\n        },\n    });\n}\n\nexport function getColumnFromFieldService({ selectdbDS, database, table }: { selectdbDS: any; database: string; table: string }) {\n    // return getBackendSrv().fetch({\n    //     url: '/api/ds/query',\n    //     method: 'POST',\n    //     data: {\n    //         queries: [\n    //             {\n    //                 refId: 'getColumnFromFieldService',\n    //                 datasource: { type: 'mysql', uid: selectdbDS.uid },\n    //                 rawSql: `SHOW COLUMNS FROM \\`${database}\\`.\\`${table}\\``,\n    //                 format: 'table',\n    //             },\n    //         ],\n    //     },\n    // });\n}\n\nexport function getIndexesService({ selectdbDS, database, table }: { selectdbDS: any; database: string; table: string }) {\n    return getBackendSrv().fetch({\n        url: '/api/ds/query',\n        method: 'POST',\n        data: {\n            queries: [\n                {\n                    refId: 'getIndexes',\n                    datasource: { type: 'mysql', uid: selectdbDS.uid },\n                    rawSql: `SHOW INDEXES FROM \\`${database}\\`.\\`${table}\\``,\n                    format: 'table',\n                },\n            ],\n        },\n    });\n}\n"],"names":["LoadingState","PanelRenderer","Drawer","LoadingPlaceholder","useAtom","useAtomValue","React","useEffect","getTableDataTraceService","currentCatalogAtom","currentDatabaseAtom","tableTracesDataAtom","selectedDatasourceAtom","selectedRowAtom","currentTraceTableAtom","formatTracesResData","TraceDetail","props","currentTable","currentCatalog","currentDatabase","traceData","setTraceData","selectedRow","selectdbDS","traceTable","loading","setLoading","useState","open","traceId","getTraceData","useCallback","payload","catalog","database","table","cluster","sort","trace_id","subscribe","next","data","ok","formatedData","results","getTableDataTrace","frames","error","err","console","log","renderTracePanel","title","width","height","pluginId","options","state","Loading","Done","series","timeRange","from","Date","now","to","raw","onClose","size","text","stableStringify","value","seen","WeakSet","recur","v","t","Number","isFinite","String","JSON","stringify","toString","has","add","Array","isArray","map","join","keys","Object","body","k","u8ToHex","u8","out","i","length","padStart","hasSubtle","window","crypto","isSecureContext","subtle","digest","sha256HexJS","K","Uint32Array","h0","h1","h2","h3","h4","h5","h6","h7","l","bitLenHi","bitLenLo","nBlocks","M","W","rotr","x","n","s0","s1","a","b","c","d","e","f","g","h","S1","ch","T1","S0","maj","T2","Uint8Array","H","sha256Hex","input","TextEncoder","encode","buf","generateUid","obj","json","generateTableDataUID","items","sources","it","_original","uids","Promise","all","_uid","isIgnorableHighlightToken","token","ignoreChars","Set","trim","test","getQueryTableTraceSQL","params","sql","parseDuration","endsWith","parseFloat","replace","tagsToDorisSQLConditions","tags","conditions","regex","match","exec","key","val","push","buildTraceAggSQLFromParams","timeFilter","timeField","startDate","endDate","serviceFilter","service_name","operationFilter","operation","statusFilter","statusCode","minDuration","maxDuration","durationFilter","tagsFilter","rootSpansFilter","limit","page_size","offset","Math","max","page","rowNumberOrderBy","sortBy","query","getServiceListSQL","getOperationListSQL","getBackendSrv","rest","traceSQL","fetch","url","method","queries","refId","datasource","type","uid","rawSql","format","credentials","getTracesService","getTracesSQL","getServiceListService","serviceListSQL","getOperationListService","operationListSQL","DEFAULT_OPERATION","DEFAULT_SERVICE","atom","currentServiceAtom","currentOperationAtom","currentSortAtom","tagsAtom","tracesAtom","tracesServicesAtom","traceOperationsAtom","minDurationAtom","maxDurationAtom","atomWithStorage","selectAtom","atomWithLocation","IntervalEnum","AggregatableEnum","DISCOVER_DEFAULT_STATUS","DISCOVER_SHORTCUTS","FieldTypeEnum","SearchableEnum","locationAtom","dataFilterAtom","discoverCurrentAtom","databasesAtom","tablesAtom","searchTypeAtom","current","currentTableAtom","currentClusterAtom","currentTimeFieldAtom","currentDateAtom","range","currentIndexAtom","selectedIndexesAtom","searchValueAtom","searchFocusAtom","activeShortcutAtom","dorisInfoAtom","disabledOptionsAtom","selectedFieldsAtom","tableFieldsAtom","timeFieldsAtom","tableDataAtom","topDataAtom","surroundingTableDataAtom","tableDataChartsAtom","intervalAtom","Auto","tableTotalCountAtom","tableEChartsDataAtom","searchableAtom","ANY","aggregatableAtom","fieldTypeAtom","indexesAtom","tableFieldValuesAtom","pageAtom","pageSizeAtom","surroundingDataFilterAtom","beforeTimeFieldPageSizeAtom","afterTimeFieldPageSizeAtom","beforeTimeAtom","afterTimeAtom","beforeCountAtom","afterCountAtom","surroundingTableFieldsAtom","surroundingSelectedFieldsAtom","datasourcesAtom","timeRangeAtom","toDate","discoverLoadingAtom","getTableData","getTopData","getSurroundingData","getTableDataCharts","getTableFieldValues","getIndexes","getTimeFields","getTableFields","getAutoInterval","dayjs","flatten","orderBy","some","nanoid","jsTokens","localeData","FieldType","utc","extend","OPERATORS","SQL_OPERATORS","TIME_FIELD_TYPES","isValidTimeFieldType","fieldType","baseFieldType","split","includes","CAN_SEARCH_FIELD_TYPE","ENABLE_SEARCH_FIELD_TYPE","getFieldType","columnType","currentColumnType","FIELD_TYPES","find","item","toLocaleUpperCase","date","SEARCHABLE","label","AGGREGATABLE","ParamsKeyEnum","getFilterSQL","fieldName","operator","valueString","addSqlFilter","dataFilterValue","result","toUpperCase","isWrappedInQuotes","inputString","pattern","getIndexesStatement","indexes","allField","keywords","searchValue","indexesNames","columnName","reduce","prevValue","currValue","currentField","field","currentFieldType","Type","canSearchField","startOf","number","SURROUNDING_LOGS_OPERATORS","getLatestTime","id","selectedItem","TIME_INTERVALS","PAGESIZE_OPTIONS","icon","complex","encodeBase64","str","btoa","encodeURIComponent","p1","fromCharCode","parseInt","decodeBase64","base64","decodeURIComponent","atob","charCodeAt","isComplexType","formatDate","interval","date_format","resetDate","date_reset","set","getDateRange","DATE_FORMAT","interval_unit","isSame","formatStartDate","dates","interval_value","isBefore","getChartsData","tableDataCharts","currentDate","selectInterval","intervalUnit","timeInterval","tableDataMap","Map","DATE_FORMAT_FROM_INTERVAL","forEach","currentLocale","locale","newDate","get","TT","convertColumnToRow","frame","fieldNames","schema","fields","name","columns","values","numRows","rows","row","j","formatTimestampToDateTime","precision","parse","convertColumnToRowViaFieldsType","currentFieldInfo","filter","Field","timestamp","formatString","repeat","traceDataFrame","typeInfo","config","other","getSearchTableData","tokenizeFields","tableResult","tableItem","searchField","searchString","parseKeywords","keyword","substring","highlightDelimiter","inputStr","delimiter","highlighted","RegExp","insertUnderscore","arr","index","compare_ignore_quotes","s2","cleanS1","cleanS2","generateHighlightedResults","search_value","searchTableData","keywordsTokens","res","toLowerCase","_sourceResult","itemSource","highlightValue","itemValue","strValue","parsedKeyword","tokenizedAns","ans","ansWithUnderscore","acc","curr","content","_source","toDataFrame","lastValueFrom","escapeSqlLiteral","normalizeColumnType","dataType","source","lower","startsWith","inner","slice","normalizedInner","undefined","getColumn","connectionId","column","datasourceType","response$","resultData","nameField","dataTypeField","columnTypeField","dataFrame","dataTypeValue","columnTypeValue","columnInfo","normalizedType","getInvertedIndexColumns","getInvertedIndexes","columnNameField","indexTypeField","columnNames","indexTypes","indexedColumns","indexType","getDatabases","getTablesService","getFieldsService","getColumnFromFieldService","getIndexesService"],"sourceRoot":""}
{"version":3,"file":"659.js?_cache=e4956ecb2028c715bcab","mappings":"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","sources":["webpack://doris-app/./services/traces.sql.ts","webpack://doris-app/./services/traces.ts","webpack://doris-app/./components/trace-detail/index.tsx","webpack://doris-app/./utils/utils.ts","webpack://doris-app/./store/traces.ts"],"sourcesContent":["import { QueryTracesParams, TracesOperationsParams, TracesServicesParams } from 'types/type';\n\ninterface QueryTraceDetailParams {\n  database: string;\n  table: string;\n  trace_id: string;\n}\n\n// 查询某个Table的Trace详情\nexport function getQueryTableTraceSQL(params: QueryTraceDetailParams): string {\n  const { table, trace_id, database } = params;\n\n  const sql = `\n      SELECT\n        trace_id AS traceID,\n        span_id AS spanID,\n        parent_span_id AS parentSpanID,\n        span_name AS operationName,\n        service_name AS serviceName,\n        CONCAT(\n          '[',\n          array_join(\n            array_map(\n              (x, y) -> json_object('key', x, 'value', y),\n              map_keys(CAST(CAST(resource_attributes AS TEXT) AS MAP<STRING, STRING>)),\n              map_values(CAST(CAST(resource_attributes AS TEXT) AS MAP<STRING, STRING>))\n            ),\n            ','\n          ),\n          ']'\n        ) AS serviceTags,\n        UNIX_TIMESTAMP(timestamp) * 1000 AS startTime,\n        duration / 1000 AS duration,\n        CONCAT(\n          '[',\n          array_join(\n            array_map(\n              (x, y) -> json_object('key', x, 'value', y),\n              map_keys(CAST(CAST(span_attributes AS TEXT) AS MAP<STRING, STRING>)),\n              map_values(CAST(CAST(span_attributes AS TEXT) AS MAP<STRING, STRING>))\n            ),\n            ','\n          ),\n          ']'\n        ) AS tags,\n        span_kind AS kind,\n        CASE status_code\n          WHEN 'STATUS_CODE_OK' THEN 1\n          WHEN 'STATUS_CODE_ERROR' THEN 2\n          ELSE 0\n        END AS statusCode,\n        status_message AS statusMessage,\n        scope_name AS instrumentationLibraryName,\n        scope_version AS instrumentationLibraryVersion,\n        trace_state AS traceState\n      FROM ${database}.\\`${table}\\`\n      WHERE trace_id = '${trace_id}';\n    `;\n\n  return sql;\n}\n\nfunction parseDuration(input?: string): number {\n  if (!input) {\n    return 0;\n  }\n\n  if (input.endsWith('ms')) {\n    return parseFloat(input.replace('ms', ''));\n  } else if (input.endsWith('us')) {\n    return parseFloat(input.replace('us', '')) / 1000;\n  } else if (input.endsWith('s')) {\n    return parseFloat(input.replace('s', '')) * 1000;\n  }\n  return 0;\n}\n\nfunction tagsToDorisSQLConditions(tags?: string): string {\n  if (!tags) {\n    return '1=1';\n  }\n  const conditions: string[] = [];\n\n    const regex = /([\\w.]+)=(?:\"([^\"]+)\"|'([^']+)'|([^\\s]+))/g;\n    let match: RegExpExecArray | null;\n    while ((match = regex.exec(tags)) !== null) {\n        const key = match[1];\n        const val = match[2] || match[3] || match[4];\n        conditions.push(`span_attributes['${key}'] = '${val}'`);\n    }\n\n  return conditions.length > 0 ? conditions.join(' AND ') : '1=1';\n}\n\nexport function buildTraceAggSQLFromParams(params: QueryTracesParams): string {\n  const timeFilter = `${params.timeField} >= '${params.startDate}' AND ${params.timeField} < '${params.endDate}'`;\n\n  const serviceFilter = params.service_name && params.service_name !== 'all' ? `service_name = '${params.service_name}'` : '1=1';\n\n  const operationFilter = params.operation && params.operation !== 'all' ? `span_name = '${params.operation}'` : '1=1';\n\n  const statusFilter = params.statusCode && params.statusCode !== 'all' ? `status_code = '${params.statusCode}'` : '1=1';\n\n  const minDuration = parseDuration(params.minDuration);\n  const maxDuration = parseDuration(params.maxDuration);\n\n  let durationFilter = '1=1';\n  if (minDuration > 0 && maxDuration > 0) {\n    durationFilter = `trace_duration BETWEEN ${minDuration} AND ${maxDuration}`;\n  } else if (minDuration > 0) {\n    durationFilter = `trace_duration >= ${minDuration}`;\n  } else if (maxDuration > 0) {\n    durationFilter = `trace_duration <= ${maxDuration}`;\n  }\n\n  const tagsFilter = tagsToDorisSQLConditions(params.tags);\n\n  let rootSpansFilter = '1=1';\n  if (params.service_name && params.service_name !== 'all') {\n    rootSpansFilter = `service_name = '${params.service_name}'`;\n  }\n  if (params.operation && params.operation !== 'all') {\n    rootSpansFilter += ` AND span_name = '${params.operation}'`;\n  }\n\n  const limit = params.page_size ?? 1000;\n  const offset = Math.max(((params.page ?? 1) - 1) * limit, 0);\n\n  let rowNumberOrderBy = 'time DESC';\n  switch (params.sortBy) {\n    case 'longest-duration':\n      rowNumberOrderBy = 'trace_duration_ms DESC';\n      break;\n    case 'shortest-duration':\n      rowNumberOrderBy = 'trace_duration_ms ASC';\n      break;\n    case 'most-spans':\n      rowNumberOrderBy = 'spans DESC';\n      break;\n    case 'least-spans':\n      rowNumberOrderBy = 'spans ASC';\n      break;\n    case 'most-recent':\n      rowNumberOrderBy = 'time DESC';\n      break;\n  }\n\n  const query = `\nUSE ${params.database};\n\nWITH\n  trace_durations AS (\n    SELECT\n      trace_id,\n      (UNIX_TIMESTAMP(MAX(end_time)) - UNIX_TIMESTAMP(MIN(timestamp))) * 1000 AS trace_duration\n    FROM ${params.table}\n    WHERE ${timeFilter}\n    GROUP BY trace_id\n  ),\n  all_trace_ids AS (\n    SELECT\n      t.trace_id,\n      MIN(t.${params.timeField}) AS time,\n      d.trace_duration\n    FROM ${params.table} t\n    JOIN trace_durations d ON t.trace_id = d.trace_id\n    WHERE\n      ${timeFilter}\n      AND ${serviceFilter}\n      AND ${operationFilter}\n      AND ${statusFilter}\n      AND ${tagsFilter}\n      AND 1=1\n      AND ${durationFilter}\n    GROUP BY t.trace_id, d.trace_duration\n  ),\n  root_spans AS (\n    SELECT trace_id, span_name AS operation, service_name AS root_service\n    FROM ${params.table}\n    WHERE (parent_span_id IS NULL\n    OR parent_span_id = '')\n    AND ${timeFilter}\n    AND ${rootSpansFilter}\n    group by trace_id,operation,root_service\n  ),\n  aggregated AS (\n    SELECT\n      UNIX_TIMESTAMP(MIN(t.${params.timeField})) AS time,\n      t.trace_id,\n      r.operation,\n      r.root_service,\n      COLLECT_SET(t.service_name) AS services,\n      COUNT(*) AS spans,\n      SUM(IF(status_code = 'STATUS_CODE_ERROR', 1, 0)) AS error_spans,\n      MAX(duration) / 1000 AS max_span_duration_ms,\n      MAX(UNIX_TIMESTAMP(t.timestamp) * 1000 + duration / 1000) - MIN(UNIX_TIMESTAMP(t.timestamp) * 1000) AS trace_duration_ms,\n      MAX(IF(t.parent_span_id IS NULL OR t.parent_span_id = '', duration, 0)) / 1000 AS root_span_duration_ms\n    FROM ${params.table} t\n    JOIN all_trace_ids a ON t.trace_id = a.trace_id\n    JOIN root_spans r ON t.trace_id = r.trace_id\n    GROUP BY t.trace_id, r.operation, r.root_service\n  ),\n  numbered AS (\n    SELECT\n      a.*,\n      COUNT(*) OVER() AS total_count,\n      ROW_NUMBER() OVER(ORDER BY ${rowNumberOrderBy}) AS rn\n    FROM aggregated a\n  )\n\nSELECT\n  *,\n  total_count AS total\nFROM numbered\nWHERE rn > ${offset} AND rn <= ${offset + limit}\nORDER BY ${rowNumberOrderBy};\n`;\n\n  return query;\n}\n\nexport function getServiceListSQL(params: TracesServicesParams): string {\n  return `\n    SELECT DISTINCT service_name \n    FROM ${params.table} \n    WHERE ${params.timeField} BETWEEN '${params.startDate}' AND '${params.endDate}' \n    ORDER BY service_name ASC\n  `;\n}\n\nexport function getOperationListSQL(params: TracesOperationsParams): string {\n  return `\n    SELECT DISTINCT span_name \n    FROM ${params.table} \n    WHERE ${params.timeField} BETWEEN '${params.startDate}' AND '${params.endDate}' \n    AND service_name = '${params.service_name}'\n    ORDER BY span_name ASC\n  `;\n}\n","import { getBackendSrv } from \"@grafana/runtime\";\nimport { buildTraceAggSQLFromParams, getOperationListSQL, getQueryTableTraceSQL, getServiceListSQL } from \"./traces.sql\";\n\n// 获取table的Trace数据\nexport function getTableDataTraceService(payload: any) {\n    const { selectdbDS, ...rest } = payload;\n    const traceSQL = getQueryTableTraceSQL(rest);\n    return getBackendSrv().fetch({\n        url: '/api/ds/query',\n        method: 'POST',\n        data: {\n            queries: [\n                {\n                    refId: 'getTableDataTrace',\n                    datasource: {\n                        type: 'mysql',\n                        uid: selectdbDS.uid,\n                    },\n                    rawSql: traceSQL,\n                    format: 'table',\n                },\n            ],\n        },\n        credentials: 'include',\n    });\n}\n\n// 查询Traces\nexport function getTracesService(payload: any) {\n    const { selectdbDS, ...rest } = payload;\n    const getTracesSQL = buildTraceAggSQLFromParams(rest);\n    return getBackendSrv().fetch({\n        url: '/api/ds/query',\n        method: 'POST',\n        data: {\n            queries: [\n                {\n                    refId: 'getTraces',\n                    datasource: {\n                        type: 'mysql',\n                        uid: selectdbDS.uid,\n                    },\n                    rawSql: getTracesSQL,\n                    format: 'table',\n                },\n            ],\n        },\n        credentials: 'include',\n    });\n}\n\n// 查询Trace Services\nexport function getServiceListService(payload: any) {\n    const { selectdbDS, ...rest } = payload;\n    const serviceListSQL = getServiceListSQL(rest);\n    return getBackendSrv().fetch({\n        url: '/api/ds/query',\n        method: 'POST',\n        data: {\n            queries: [\n                {\n                    refId: 'getServiceList',\n                    datasource: {\n                        type: 'mysql',\n                        uid: selectdbDS.uid,\n                    },\n                    rawSql: serviceListSQL,\n                    format: 'table',\n                },\n            ],\n        },\n        credentials: 'include',\n    });\n}\n\n// 查询Trace Operations\nexport function getOperationListService(payload: any) {\n    const { selectdbDS, ...rest } = payload;\n    const operationListSQL = getOperationListSQL(rest);\n    return getBackendSrv().fetch({\n        url: '/api/ds/query',\n        method: 'POST',\n        data: {\n            queries: [\n                {\n                    refId: 'getOperationList',\n                    datasource: {\n                        type: 'mysql',\n                        uid: selectdbDS.uid,\n                    },\n                    rawSql: operationListSQL,\n                    format: 'table',\n                },\n            ],\n        },\n        credentials: 'include',\n    });\n}\n\n\n\n","import { LoadingState } from '@grafana/data';\nimport { PanelRenderer } from '@grafana/runtime';\nimport { Drawer, LoadingPlaceholder } from '@grafana/ui';\nimport { useAtom, useAtomValue } from 'jotai';\nimport React, { useEffect } from 'react';\nimport { getTableDataTraceService } from 'services/traces';\nimport { currentCatalogAtom, currentDatabaseAtom, tableTracesDataAtom, selectedDatasourceAtom, selectedRowAtom } from 'store/discover';\nimport { currentTraceTableAtom } from 'store/traces';\nimport { formatTracesResData } from 'utils/data';\n\nexport default function TraceDetail(props: { onClose?: () => void; open: boolean; traceId?: string; traceTable?: string }) {\n    const currentTable = useAtomValue(currentTraceTableAtom);\n    const currentCatalog = useAtomValue(currentCatalogAtom);\n    const currentDatabase = useAtomValue(currentDatabaseAtom);\n    const [traceData, setTraceData] = useAtom(tableTracesDataAtom);\n    const selectedRow = useAtomValue(selectedRowAtom);\n    const selectdbDS = useAtomValue(selectedDatasourceAtom);\n    const traceTable = props?.traceTable || currentTable || 'otel_traces';\n    const [loading, setLoading] = React.useState(false);\n\n    const { open, traceId } = props;\n\n    const getTraceData = React.useCallback(() => {\n        let payload: any = {\n            catalog: currentCatalog,\n            database: currentDatabase,\n            table: traceTable,\n            cluster: '',\n            sort: 'DESC',\n            trace_id: traceId || '',\n        };\n        setLoading(true);\n\n        getTableDataTraceService({\n            selectdbDS,\n            ...payload,\n        }).subscribe({\n            next: ({ data, ok }: any) => {\n                setLoading(false);\n                if (ok) {\n                    const formatedData = formatTracesResData(data.results.getTableDataTrace.frames[0]);\n                    setTraceData(formatedData);\n                }\n            },\n            error: (err: any) => {\n                setLoading(false);\n                console.log('Fetch Error', err);\n            },\n        });\n    }, [currentCatalog, currentDatabase, traceTable, selectdbDS, setTraceData, traceId]);\n\n    useEffect(() => {\n        if (traceId) {\n            getTraceData();\n        }\n    }, [selectedRow.trace_id, currentCatalog, currentDatabase, selectdbDS, setTraceData, getTraceData, traceId]);\n\n    function renderTracePanel() {\n        if (traceData) {\n            return (\n                <PanelRenderer\n                    title=\"trace panel\"\n                    width={200}\n                    height={300}\n                    pluginId=\"traces\"\n                    options={{}}\n                    data={{\n                        state: loading ? LoadingState.Loading : LoadingState.Done,\n                        series: [traceData],\n                        timeRange: {\n                            from: new Date(Date.now() - 15 * 60 * 1000) as any, // 15 分钟前\n                            to: new Date() as any,\n                            raw: {\n                                from: 'now-15m',\n                                to: 'now',\n                            },\n                        },\n                    }}\n                />\n            );\n        }\n        return null;\n    }\n\n    return (\n        <>\n            {open && (\n                <Drawer\n                    title=\"Trace Panel\"\n                    onClose={() => {\n                        props?.onClose?.();\n                    }}\n                    size=\"lg\"\n                >\n                    {loading ? <LoadingPlaceholder text={`Loading`} /> : renderTracePanel()}\n                </Drawer>\n            )}\n        </>\n    );\n}\n","// --- stable stringify: 递归排序键，避免循环引用导致崩溃 ---\nfunction stableStringify(value: any): string {\n    const seen = new WeakSet();\n\n    const recur = (v: any): string => {\n        if (v === null) {\n            return 'null';\n        }\n        const t = typeof v;\n        if (t === 'number') {\n            return Number.isFinite(v) ? String(v) : 'null';\n        }\n        if (t === 'boolean') {\n            return v ? 'true' : 'false';\n        }\n        if (t === 'string') {\n            return JSON.stringify(v);\n        }\n        if (t === 'bigint') {\n            return JSON.stringify(v.toString());\n        }\n        if (t === 'undefined' || t === 'function' || t === 'symbol') {\n            return 'null';\n        }\n\n        // object / array\n        if (seen.has(v)) {\n            return '\"[Circular]\"';\n        }\n        seen.add(v);\n\n        if (Array.isArray(v)) {\n            return '[' + v.map(recur).join(',') + ']';\n        }\n\n        const keys = Object.keys(v).sort();\n        const body = keys.map(k => JSON.stringify(k) + ':' + recur(v[k])).join(',');\n        return '{' + body + '}';\n    };\n\n    return recur(value);\n}\n\n// --- 小工具 ---\nfunction u8ToHex(u8: Uint8Array): string {\n    let out = '';\n    for (let i = 0; i < u8.length; i++) {\n        out += u8[i].toString(16).padStart(2, '0');\n    }\n    return out;\n}\n\nfunction hasSubtle(): boolean {\n    return typeof window !== 'undefined' && !!window.crypto && !!window.isSecureContext && typeof window.crypto.subtle?.digest === 'function';\n}\n\n// --- 纯 JS 的 SHA-256 fallback（简实现，无依赖） ---\nfunction sha256HexJS(data: Uint8Array): string {\n    // 常量\n    const K = new Uint32Array([\n        0x428a2f98, 0x71374491, 0xb5c0fbcf, 0xe9b5dba5, 0x3956c25b, 0x59f111f1, 0x923f82a4, 0xab1c5ed5, 0xd807aa98, 0x12835b01, 0x243185be, 0x550c7dc3, 0x72be5d74, 0x80deb1fe,\n        0x9bdc06a7, 0xc19bf174, 0xe49b69c1, 0xefbe4786, 0x0fc19dc6, 0x240ca1cc, 0x2de92c6f, 0x4a7484aa, 0x5cb0a9dc, 0x76f988da, 0x983e5152, 0xa831c66d, 0xb00327c8, 0xbf597fc7,\n        0xc6e00bf3, 0xd5a79147, 0x06ca6351, 0x14292967, 0x27b70a85, 0x2e1b2138, 0x4d2c6dfc, 0x53380d13, 0x650a7354, 0x766a0abb, 0x81c2c92e, 0x92722c85, 0xa2bfe8a1, 0xa81a664b,\n        0xc24b8b70, 0xc76c51a3, 0xd192e819, 0xd6990624, 0xf40e3585, 0x106aa070, 0x19a4c116, 0x1e376c08, 0x2748774c, 0x34b0bcb5, 0x391c0cb3, 0x4ed8aa4a, 0x5b9cca4f, 0x682e6ff3,\n        0x748f82ee, 0x78a5636f, 0x84c87814, 0x8cc70208, 0x90befffa, 0xa4506ceb, 0xbef9a3f7, 0xc67178f2,\n    ]);\n\n    // 初始哈希\n    let h0 = 0x6a09e667,\n        h1 = 0xbb67ae85,\n        h2 = 0x3c6ef372,\n        h3 = 0xa54ff53a,\n        h4 = 0x510e527f,\n        h5 = 0x9b05688c,\n        h6 = 0x1f83d9ab,\n        h7 = 0x5be0cd19;\n\n    // 预处理：填充\n    const l = data.length;\n    const bitLenHi = (l >>> 29) >>> 0;\n    const bitLenLo = (l << 3) >>> 0;\n    const nBlocks = (((l + 9) >> 6) + 1) << 4; // 以 16 个 32bit 为一组\n    const M = new Uint32Array(nBlocks);\n\n    for (let i = 0; i < l; i++) {\n        M[i >> 2] |= data[i] << ((3 - (i & 3)) << 3);\n    }\n    M[l >> 2] |= 0x80 << ((3 - (l & 3)) << 3);\n    M[nBlocks - 2] = bitLenHi;\n    M[nBlocks - 1] = bitLenLo;\n\n    const W = new Uint32Array(64);\n\n    const rotr = (x: number, n: number) => (x >>> n) | (x << (32 - n));\n    for (let i = 0; i < nBlocks; i += 16) {\n        for (let t = 0; t < 16; t++) {\n            W[t] = M[i + t];\n        }\n        for (let t = 16; t < 64; t++) {\n            const s0 = (rotr(W[t - 15], 7) ^ rotr(W[t - 15], 18) ^ (W[t - 15] >>> 3)) >>> 0;\n            const s1 = (rotr(W[t - 2], 17) ^ rotr(W[t - 2], 19) ^ (W[t - 2] >>> 10)) >>> 0;\n            W[t] = (W[t - 16] + s0 + W[t - 7] + s1) >>> 0;\n        }\n\n        let a = h0,\n            b = h1,\n            c = h2,\n            d = h3,\n            e = h4,\n            f = h5,\n            g = h6,\n            h = h7;\n\n        for (let t = 0; t < 64; t++) {\n            const S1 = (rotr(e, 6) ^ rotr(e, 11) ^ rotr(e, 25)) >>> 0;\n            const ch = ((e & f) ^ (~e & g)) >>> 0;\n            const T1 = (h + S1 + ch + K[t] + W[t]) >>> 0;\n            const S0 = (rotr(a, 2) ^ rotr(a, 13) ^ rotr(a, 22)) >>> 0;\n            const maj = ((a & b) ^ (a & c) ^ (b & c)) >>> 0;\n            const T2 = (S0 + maj) >>> 0;\n\n            h = g;\n            g = f;\n            f = e;\n            e = (d + T1) >>> 0;\n            d = c;\n            c = b;\n            b = a;\n            a = (T1 + T2) >>> 0;\n        }\n\n        h0 = (h0 + a) >>> 0;\n        h1 = (h1 + b) >>> 0;\n        h2 = (h2 + c) >>> 0;\n        h3 = (h3 + d) >>> 0;\n        h4 = (h4 + e) >>> 0;\n        h5 = (h5 + f) >>> 0;\n        h6 = (h6 + g) >>> 0;\n        h7 = (h7 + h) >>> 0;\n    }\n\n    const out = new Uint8Array(32);\n    const H = [h0, h1, h2, h3, h4, h5, h6, h7];\n    for (let i = 0; i < 8; i++) {\n        out[i * 4 + 0] = (H[i] >>> 24) & 0xff;\n        out[i * 4 + 1] = (H[i] >>> 16) & 0xff;\n        out[i * 4 + 2] = (H[i] >>> 8) & 0xff;\n        out[i * 4 + 3] = H[i] & 0xff;\n    }\n    return u8ToHex(out);\n}\n\n// --- 通用 SHA-256（浏览器优先，fallback 到纯 JS） ---\nasync function sha256Hex(input: string): Promise<string> {\n    const data = new TextEncoder().encode(input);\n    if (hasSubtle()) {\n        const buf = await window.crypto.subtle.digest('SHA-256', data);\n        return u8ToHex(new Uint8Array(buf));\n    }\n    // 非 https 或老环境：走纯 JS\n    return sha256HexJS(data);\n}\n\n// --- 你的两个导出函数 ---\nexport async function generateUid(obj: any) {\n    const json = stableStringify(obj);\n    return sha256Hex(json);\n}\n\nexport async function generateTableDataUID(items: any[]) {\n    // 允许 _original 缺失时退回整个 item；并发计算，更快\n    const sources = items.map(it => (it && it._original) ?? it);\n    const uids = await Promise.all(sources.map(generateUid));\n    return items.map((it, i) => ({ ...it, _uid: uids[i] }));\n}\n\n\nexport function isIgnorableHighlightToken(token: string): boolean {\n    const ignoreChars = new Set([\n        ',',\n        '.',\n        ';',\n        ':',\n        '(',\n        ')',\n        '{',\n        '}',\n        '[',\n        ']',\n        '+',\n        '-',\n        '*',\n        '/',\n        '=',\n        '<',\n        '>',\n        '!',\n        '?',\n        '|',\n        '&',\n        '%',\n        '^',\n        '$',\n        '#',\n        '@',\n        '~',\n        '`',\n        '\\\\',\n        \"'\",\n        '\"',\n    ]);\n    // 全是空格或换行\n    if (!token.trim()) {return true;}\n    // 单个字符且在 ignoreChars 中\n    if (token.length === 1 && ignoreChars.has(token)) {return true;}\n    // 多个字符但全是标点符号\n    if (/^[\\u2000-\\u206F\\u2E00-\\u2E7F!\"#$%&'()*+,\\-./:;<=>?@[\\\\\\]^_`{|}~]+$/.test(token)) {\n        return true;\n    }\n\n    return false;\n}\n\nexport function trimSpacesAroundEquals(str: string) {\n  // 去掉等于号两边所有空格\n  return str.replace(/\\s*=\\s*/g, '=');\n}\n\n","import { DEFAULT_OPERATION, DEFAULT_SERVICE } from '../constants';\nimport { atom } from 'jotai';\n\n\nexport const currentTraceTableAtom = atom<string>('');\nexport const currentServiceAtom = atom<any>(DEFAULT_SERVICE);\nexport const currentOperationAtom = atom<any>(DEFAULT_OPERATION);\nexport const currentSortAtom = atom<any>('most-recent');\nexport const tagsAtom = atom<string>('');\nexport const tracesAtom = atom<any>([]);\nexport const tracesServicesAtom = atom<any>([]);\nexport const traceOperationsAtom = atom<any>([]);\nexport const minDurationAtom = atom<any>('');\nexport const maxDurationAtom = atom<any>('');\n"],"names":["getQueryTableTraceSQL","params","table","trace_id","database","sql","parseDuration","input","endsWith","parseFloat","replace","tagsToDorisSQLConditions","tags","conditions","regex","match","exec","key","val","push","length","join","buildTraceAggSQLFromParams","timeFilter","timeField","startDate","endDate","serviceFilter","service_name","operationFilter","operation","statusFilter","statusCode","minDuration","maxDuration","durationFilter","tagsFilter","rootSpansFilter","limit","page_size","offset","Math","max","page","rowNumberOrderBy","sortBy","query","getServiceListSQL","getOperationListSQL","getBackendSrv","getTableDataTraceService","payload","selectdbDS","rest","traceSQL","fetch","url","method","data","queries","refId","datasource","type","uid","rawSql","format","credentials","getTracesService","getTracesSQL","getServiceListService","serviceListSQL","getOperationListService","operationListSQL","LoadingState","PanelRenderer","Drawer","LoadingPlaceholder","useAtom","useAtomValue","React","useEffect","currentCatalogAtom","currentDatabaseAtom","tableTracesDataAtom","selectedDatasourceAtom","selectedRowAtom","currentTraceTableAtom","formatTracesResData","TraceDetail","props","currentTable","currentCatalog","currentDatabase","traceData","setTraceData","selectedRow","traceTable","loading","setLoading","useState","open","traceId","getTraceData","useCallback","catalog","cluster","sort","subscribe","next","ok","formatedData","results","getTableDataTrace","frames","error","err","console","log","renderTracePanel","title","width","height","pluginId","options","state","Loading","Done","series","timeRange","from","Date","now","to","raw","onClose","size","text","stableStringify","value","seen","WeakSet","recur","v","t","Number","isFinite","String","JSON","stringify","toString","has","add","Array","isArray","map","keys","Object","body","k","u8ToHex","u8","out","i","padStart","hasSubtle","window","crypto","isSecureContext","subtle","digest","sha256HexJS","K","Uint32Array","h0","h1","h2","h3","h4","h5","h6","h7","l","bitLenHi","bitLenLo","nBlocks","M","W","rotr","x","n","s0","s1","a","b","c","d","e","f","g","h","S1","ch","T1","S0","maj","T2","Uint8Array","H","sha256Hex","TextEncoder","encode","buf","generateUid","obj","json","generateTableDataUID","items","sources","it","_original","uids","Promise","all","_uid","isIgnorableHighlightToken","token","ignoreChars","Set","trim","test","trimSpacesAroundEquals","str","DEFAULT_OPERATION","DEFAULT_SERVICE","atom","currentServiceAtom","currentOperationAtom","currentSortAtom","tagsAtom","tracesAtom","tracesServicesAtom","traceOperationsAtom","minDurationAtom","maxDurationAtom"],"sourceRoot":""}